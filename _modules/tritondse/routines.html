<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tritondse.routines &mdash; TritonDSE 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=2709fde1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TritonDSE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/starting.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/seeds.html">Seeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/sanitizers.html">Sanitizers &amp; Probes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/loaders.html">Loaders</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/callbacks.html">Callback Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/executor.html">SymbolicExecutor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/explorator.html">SymbolicExplorator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/exception.html">Exception</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/loaders.html">Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/process.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/sanitizers.html">Sanitizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/seeds.html">Seed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracing.html">Trace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/workspace.html">Workspace</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Practicals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../practicals/toy_example.html">Toy Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../practicals/json_parser.html">JSON Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../practicals/crackme.html">Crackme</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_doc/routines.html">Supported Routines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_doc/seedscheduling.html">Seed Scheduling</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TritonDSE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tritondse.routines</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tritondse.routines</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">tritondse.types</span> <span class="kn">import</span> <span class="n">Architecture</span><span class="p">,</span> <span class="n">FileDesc</span>
<span class="kn">from</span> <span class="nn">tritondse.seed</span> <span class="kn">import</span> <span class="n">SeedFormat</span><span class="p">,</span> <span class="n">SeedStatus</span><span class="p">,</span> <span class="n">Seed</span>
<span class="kn">import</span> <span class="nn">tritondse.logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">tritondse</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;routines&quot;</span><span class="p">)</span>

<span class="n">NULL_PTR</span> <span class="o">=</span> <span class="mi">0</span>



<div class="viewcode-block" id="rtn_ctype_b_loc">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_ctype_b_loc">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_ctype_b_loc</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __ctype_b_loc behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__ctype_b_loc hooked&#39;</span><span class="p">)</span>

    <span class="n">ctype</span>  <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00</span><span class="s2">&quot;</span>  <span class="c1"># must point here</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x02\x00\x03\x20\x02\x20\x02\x20\x02\x20\x02\x20\x02\x00\x02\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00\x02\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01\x60\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xd8\x08\xd8\x08\xd8\x08\xd8\x08\xd8\x08\xd8\x08\xd8\x08\xd8</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xd8\x08\xd8\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x04\xc0\x08\xd5\x08\xd5\x08\xd5\x08\xd5\x08\xd5\x08\xd5\x08\xc5</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5\x08\xc5</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xc5\x08\xc5\x08\xc5\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x04\xc0</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x04\xc0\x08\xd6\x08\xd6\x08\xd6\x08\xd6\x08\xd6\x08\xd6\x08\xc6</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6\x08\xc6</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08\xc6\x08\xc6\x08\xc6\x04\xc0\x04\xc0\x04\xc0\x04\xc0\x02\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>

    <span class="c1"># Allocate on heap enough to make the table to fit</span>
    <span class="n">alloc_size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctype</span><span class="p">)</span>
    <span class="n">base_ctype</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">alloc_size</span><span class="p">)</span>

    <span class="n">ctype_table_offset</span> <span class="o">=</span> <span class="n">base_ctype</span> <span class="o">+</span> <span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">otable_offset</span> <span class="o">=</span> <span class="n">ctype_table_offset</span> <span class="o">+</span> <span class="mi">256</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">base_ctype</span><span class="p">,</span> <span class="n">otable_offset</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">base_ctype</span><span class="o">+</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># FIXME: On pourrait la renvoyer qu&#39;une seule fois ou la charger au demarage direct dans pstate</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ctype_table_offset</span><span class="p">,</span> <span class="n">ctype</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">base_ctype</span></div>


<div class="viewcode-block" id="rtn_ctype_toupper_loc">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_ctype_toupper_loc">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_ctype_toupper_loc</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
    <span class="c1"># FIXME: Not sure about the array and where to place the pointer </span>
    <span class="c1"># https://codebrowser.dev/glibc/glibc/locale/C-ctype.c.html</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __ctype_toupper_loc behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__ctype_toupper_loc hooked&#39;</span><span class="p">)</span>

    <span class="n">ctype</span>  <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\xff\xff\xff</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x60\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x7b\x7c\x7d\x7e\x7f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef</span><span class="s2">&quot;</span>
    <span class="n">ctype</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class="s2">&quot;</span>

    <span class="c1"># Allocate on heap enough to make the table to fit</span>
    <span class="n">alloc_size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctype</span><span class="p">)</span>
    <span class="n">base_ctype</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">alloc_size</span><span class="p">)</span>

    <span class="n">ctype_table_offset</span> <span class="o">=</span> <span class="n">base_ctype</span> <span class="o">+</span> <span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">otable_offset</span> <span class="o">=</span> <span class="n">ctype_table_offset</span> <span class="o">+</span> <span class="mi">256</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">base_ctype</span><span class="p">,</span> <span class="n">otable_offset</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">base_ctype</span><span class="o">+</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># FIXME: On pourrait la renvoyer qu&#39;une seule fois ou la charger au demarage direct dans pstate</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ctype_table_offset</span><span class="p">,</span> <span class="n">ctype</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">base_ctype</span></div>



<div class="viewcode-block" id="rtn_errno_location">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_errno_location">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_errno_location</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __errno_location behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__errno_location hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Errno is a int* ptr, initialize it to zero</span>
    <span class="c1"># We consider it is located in the [extern] segment</span>
    <span class="c1"># Thus the process must have one of this map</span>
    <span class="n">segs</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">find_map</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">EXTERN_SEG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">segs</span><span class="p">:</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ERRNO</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="nb">map</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">4</span>  <span class="c1"># Point is last int of the mapping</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">ERRNO</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ERRNO</span></div>



<div class="viewcode-block" id="rtn_libc_start_main">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_libc_start_main">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_libc_start_main</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __libc_start_main behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__libc_start_main hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">main</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># WARNING: Dirty trick to make sure to jump on main after</span>
    <span class="c1"># the emulation of that stub</span>
    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">architecture</span> <span class="o">==</span> <span class="n">Architecture</span><span class="o">.</span><span class="n">AARCH64</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">x30</span> <span class="o">=</span> <span class="n">main</span>
    <span class="k">elif</span> <span class="n">pstate</span><span class="o">.</span><span class="n">architecture</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Architecture</span><span class="o">.</span><span class="n">X86_64</span><span class="p">,</span> <span class="n">Architecture</span><span class="o">.</span><span class="n">X86</span><span class="p">]:</span>
        <span class="c1"># Push the return value to jump into the main() function</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">push_stack_value</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span>

    <span class="c1"># Define concrete value of argc (from either the seed or the program_argv)</span>
    <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_format_raw</span><span class="p">():</span>
        <span class="c1"># Cannot provide argv in RAW seeds</span>
        <span class="n">argc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">program_argv</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># SeedFormat.COMPOSITE</span>
        <span class="n">argc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">argv</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">program_argv</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">architecture</span> <span class="o">==</span> <span class="n">Architecture</span><span class="o">.</span><span class="n">X86</span><span class="p">:</span>
        <span class="c1"># Because of the &quot;Dirty trick&quot; described above, we RET to main instead of CALLing it.</span>
        <span class="c1"># Because of that, the arguments end up 1 slot off on the stack</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_argument_value</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">argc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">argc</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;argc = </span><span class="si">{</span><span class="n">argc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Define argv</span>
    <span class="n">addrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_format_composite</span><span class="p">()</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span> <span class="c1"># Use the seed provided (and ignore config.program_argv !!)</span>
        <span class="n">argvs</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">argv</span>
        <span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;seed&#39;</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># use the config argv</span>
        <span class="n">argvs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">program_argv</span><span class="p">]</span>  <span class="c1"># Convert it from str to bytes</span>
        <span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;config&#39;</span>

    <span class="c1"># Compute the allocation size: size of strings, + all \x00 + all pointers</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">argvs</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">argvs</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">argvs</span><span class="p">)</span><span class="o">*</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Falback on a single pointer that will hold not even be initialized</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>

    <span class="c1"># We put the ARGV stuff on the heap even though its normally on stack</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">argvs</span><span class="p">):</span>
        <span class="n">addrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">arg</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_format_composite</span><span class="p">()</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span> <span class="c1"># Use the seed provided (and ignore config.program_argv !!)</span>
            <span class="c1"># Symbolize the argv string</span>
            <span class="n">se</span><span class="o">.</span><span class="n">inject_symbolic_argv_memory</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
            <span class="c1"># FIXME: Shall add a constraint on every char to be != \x00</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="s2">) argv[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>


    <span class="c1"># NOTE: the array of pointers will be after the string themselves</span>
    <span class="n">b_argv</span> <span class="o">=</span> <span class="n">base</span>
    <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">addrs</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">+=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>

    <span class="c1"># Concrete value</span>
    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">architecture</span> <span class="o">==</span> <span class="n">Architecture</span><span class="o">.</span><span class="n">X86</span><span class="p">:</span>
        <span class="c1"># Because of the &quot;Dirty trick&quot; described above, we RET to main instead of CALLing it.</span>
        <span class="c1"># Because of that, the arguments end up 1 slot off on the stack</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_argument_value</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b_argv</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b_argv</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="rtn_stack_chk_fail">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_stack_chk_fail">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_stack_chk_fail</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __stack_chk_fail behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__stack_chk_fail hooked&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s1">&#39;*** stack smashing detected ***: terminated&#39;</span><span class="p">)</span>
    <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SeedStatus</span><span class="o">.</span><span class="n">CRASH</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span></div>



<span class="c1"># int __xstat(int ver, const char* path, struct stat* stat_buf);</span>
<div class="viewcode-block" id="rtn_xstat">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_xstat">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_xstat</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __xstat behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__xstat hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># int ver</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># const char* path</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># struct stat* stat_buf</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">arg1</span><span class="p">)):</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">arg1</span><span class="p">))</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_dev</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_ino</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_nlink</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_mode</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_uid</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_gid</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_rdev</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_size</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_blksize</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x40</span><span class="p">,</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_blocks</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_qword</span><span class="p">(</span><span class="n">arg2</span> <span class="o">+</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span></div>



<div class="viewcode-block" id="rtn_abort">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_abort">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_abort</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;::</span>

<span class="sd">        void abort(void);</span>

<span class="sd">    Mark the input seed as OK and stop execution.</span>

<span class="sd">    [`Man Page &lt;https://man7.org/linux/man-pages/man3/abort.3.html&gt;`_]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;abort hooked&#39;</span><span class="p">)</span>
    <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">SeedStatus</span><span class="o">.</span><span class="n">OK_DONE</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span></div>



<span class="c1"># int atoi(const char *nptr);</span>
<div class="viewcode-block" id="rtn_atoi">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_atoi">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_atoi</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;::</span>

<span class="sd">        int atoi(const char *nptr);</span>

<span class="sd">    **Description**: The atoi() function converts the initial portion of the string</span>
<span class="sd">    pointed to by nptr to int.  The behavior is the same as</span>

<span class="sd">    Concrete: /</span>

<span class="sd">    Symbolic: Represent the return value symbolically with 10 nested if</span>
<span class="sd">    to represent the value.</span>

<span class="sd">    .. warning:: The function does not support all possibles representation</span>
<span class="sd">                 of an integer. It does not support negative integer nor values</span>
<span class="sd">                 prefixed by spaces.</span>

<span class="sd">    [`Man Page &lt;https://man7.org/linux/man-pages/man3/abort.3.html&gt;`_]</span>

<span class="sd">    :return: Symbolic value of the integer base on the symbolic string ``nptr``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;atoi hooked&#39;</span><span class="p">)</span>

    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># FIXME: On ne concretize pas correctement la taille de la chaine</span>

    <span class="n">cells</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">arg</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)}</span>

    <span class="c1"># FIXME: Does not support negative value and all other corner cases.</span>
    <span class="c1"># &quot;000000000012372183762173&quot;</span>
    <span class="c1"># &quot;         98273483274&quot;</span>
    <span class="c1"># &quot;-123123&quot;</span>
    <span class="c1"># &quot;18273213&quot;</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">zx</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mh">0x30</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
              <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
              <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
              <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                  <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                  <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                  <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                      <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                      <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                      <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                          <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                          <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                          <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                              <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                              <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                              <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                                  <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                                  <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                  <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                                      <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                                      <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                                      <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                                          <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                                          <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                                          <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                                              <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                                              <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                                              <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                                                  <span class="n">ast</span><span class="o">.</span><span class="n">lnot</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">cells</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0x39</span><span class="p">])),</span>
                                                  <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
                                                  <span class="n">multiply</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
                                              <span class="p">)</span>
                                          <span class="p">)</span>
                                      <span class="p">)</span>
                                  <span class="p">)</span>
                              <span class="p">)</span>
                          <span class="p">)</span>
                      <span class="p">)</span>
                  <span class="p">)</span>
              <span class="p">)</span>
          <span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">sx</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<span class="c1"># void *calloc(size_t nmemb, size_t size);</span>
<div class="viewcode-block" id="rtn_calloc">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_calloc">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_calloc</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The calloc behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calloc hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">nmemb</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">size</span>  <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># We use nmemb and size as concret values</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># will be concretized with nmemb value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># will be concretized with size value</span>

    <span class="k">if</span> <span class="n">nmemb</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="n">NULL_PTR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">nmemb</span> <span class="o">*</span> <span class="n">size</span><span class="p">)</span>
        <span class="c1"># Once the ptr allocated, the memory area must be filled with zero</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmemb</span> <span class="o">*</span> <span class="n">size</span><span class="p">):</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">ptr</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="n">ptr</span></div>



<span class="c1"># int clock_gettime(clockid_t clockid, struct timespec *tp);</span>
<div class="viewcode-block" id="rtn_clock_gettime">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_clock_gettime">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_clock_gettime</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The clock_gettime behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;clock_gettime hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">clockid</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tp</span>      <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># We use tp as concret value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># FIXME: We can return something logic</span>
    <span class="k">if</span> <span class="n">tp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">time_inc_coefficient</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">time</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">))</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_exit">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_exit">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_exit</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The exit behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;exit hooked&#39;</span><span class="p">)</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">arg</span></div>



<div class="viewcode-block" id="rtn_fclose">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fclose">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fclose</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fclose behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fclose hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># fd</span>

    <span class="c1"># We use fd as concret value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg0</span><span class="p">):</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">close_file_descriptor</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_fseek">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fseek">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fseek</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fseek behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#define SEEK_SET    0   /* set file offset to offset */</span>
    <span class="c1">#define SEEK_CUR    1   /* set file offset to current plus offset */</span>
    <span class="c1">#define SEEK_END    2   /* set file offset to EOF plus offset */</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fseek hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">arg2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span>
        <span class="c1"># TODO: set errno to: -22 # EINVAL</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg0</span><span class="p">):</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">desc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">seekable</span><span class="p">():</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c1"># TODO: set errno to: 29 # ESPIPE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>



<div class="viewcode-block" id="rtn_ftell">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_ftell">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_ftell</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ftell behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;ftell hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg0</span><span class="p">):</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">desc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">seekable</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">desc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

            <span class="c1"># TODO: set errno -22 EINVAL</span>


<span class="c1"># char *fgets(char *s, int size, FILE *stream);</span>
<div class="viewcode-block" id="rtn_fgets">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fgets">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fgets</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fgets behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fgets hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">buff</span><span class="p">,</span> <span class="n">buff_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">size</span><span class="p">,</span> <span class="n">size_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># We use fd as concret value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">fgets</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">data_no_trail</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># not \x00 terminated</span>

        <span class="k">if</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">is_input_fd</span><span class="p">():</span> <span class="c1"># Reading into input</span>
            <span class="c1"># if we started from empty seed simulate reading `size` amount of data</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_raw</span><span class="p">()</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_bootstrap_seed</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data_no_trail</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">size</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_no_trail</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>  <span class="c1"># if `size` limited the fgets its an indirect constraint</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">size_ast</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">size</span><span class="p">)</span>

            <span class="n">se</span><span class="o">.</span><span class="n">inject_symbolic_file_memory</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fgets() in </span><span class="si">{</span><span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">buff_ast</span> <span class="k">if</span> <span class="n">data_no_trail</span> <span class="k">else</span> <span class="n">NULL_PTR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File descriptor (</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s1">) not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NULL_PTR</span></div>



<span class="c1"># fopen(const char *pathname, const char *mode);</span>
<div class="viewcode-block" id="rtn_fopen">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fopen">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fopen</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fopen behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fopen hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># const char *pathname</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># const char *mode</span>
    <span class="n">arg0s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="n">arg1s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>

    <span class="c1"># Concretize the whole path name</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_memory_bytes</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg0s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Concretize the whole string + \0</span>

    <span class="c1"># We use mode as concrete value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_file_defined</span><span class="p">(</span><span class="n">arg0s</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;opening an input file: </span><span class="si">{</span><span class="n">arg0s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Program is opening an input</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">get_file_input</span><span class="p">(</span><span class="n">arg0s</span><span class="p">)</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">create_file_descriptor</span><span class="p">(</span><span class="n">arg0s</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Try to open it as a regular file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">arg0s</span><span class="p">,</span> <span class="n">arg1s</span><span class="p">)</span>
            <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">create_file_descriptor</span><span class="p">(</span><span class="n">arg0s</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">id</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to open </span><span class="si">{</span><span class="n">arg0s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">NULL_PTR</span></div>



<div class="viewcode-block" id="rtn_fprintf">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fprintf">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fprintf</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fprintf behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fprintf hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># FIXME: ARM64</span>
    <span class="c1"># FIXME: pushPathConstraint</span>

    <span class="n">arg1f</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_string</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
    <span class="n">nbArgs</span> <span class="o">=</span> <span class="n">arg1f</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_arguments</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="p">[</span><span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nbArgs</span><span class="o">+</span><span class="mi">2</span><span class="p">)])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">arg1f</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># FIXME: Les chars UTF8 peuvent foutre le bordel. Voir avec ground-truth/07.input</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Something wrong, probably UTF-8 string&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg0</span><span class="p">):</span>
        <span class="n">fdesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arg0</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arg0</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stderr</span><span class="p">):</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>



<div class="viewcode-block" id="rtn___fprintf_chk">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn___fprintf_chk">[docs]</a>
<span class="k">def</span> <span class="nf">rtn___fprintf_chk</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __fprintf_chk behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;__fprintf_chk hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># FIXME: ARM64</span>
    <span class="c1"># FIXME: pushPathConstraint</span>

    <span class="n">arg1f</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_string</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
    <span class="n">nbArgs</span> <span class="o">=</span> <span class="n">arg1f</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_arguments</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="p">[</span><span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nbArgs</span><span class="o">+</span><span class="mi">2</span><span class="p">)])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">arg1f</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># FIXME: Les chars UTF8 peuvent foutre le bordel. Voir avec ground-truth/07.input</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Something wrong, probably UTF-8 string&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg0</span><span class="p">):</span>
        <span class="n">fdesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arg0</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arg0</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stderr</span><span class="p">):</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>



<span class="c1"># fputc(int c, FILE *stream);</span>
<div class="viewcode-block" id="rtn_fputc">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fputc">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fputc</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fputc behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fputc hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
        <span class="n">fdesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">arg1</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arg1</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stderr</span><span class="p">):</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">arg0</span><span class="p">))</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">arg1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">arg0</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span></div>




<div class="viewcode-block" id="rtn_fputs">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fputs">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fputs</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fputs behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fputs hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>

    <span class="c1"># FIXME: What if the fd is coming from the memory (fmemopen) ?</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
        <span class="n">fdesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">arg1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">:</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">arg1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stderr</span><span class="p">:</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>



<div class="viewcode-block" id="rtn_fread">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fread">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fread</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fread behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fread hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># ptr</span>
    <span class="n">size_t</span><span class="p">,</span> <span class="n">size_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># size</span>
    <span class="n">nmemb</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># nmemb</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># stream</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">size_t</span> <span class="o">*</span> <span class="n">nmemb</span>

    <span class="c1"># FIXME: pushPathConstraint</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">is_input_fd</span><span class="p">():</span> <span class="c1"># Reading into input</span>
            <span class="c1"># if we started from empty seed simulate reading `size` amount of data</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_raw</span><span class="p">()</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_bootstrap_seed</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">size</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>  <span class="c1"># if `size` limited the fgets its an indirect constraint</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">size_ast</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">size</span><span class="p">)</span>

            <span class="n">se</span><span class="o">.</span><span class="n">inject_symbolic_file_memory</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;read in </span><span class="si">{</span><span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">size_t</span><span class="p">)</span> <span class="k">if</span> <span class="n">size_t</span> <span class="k">else</span> <span class="mi">0</span>  <span class="c1"># number of items read</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File descriptor (</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s1">) not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_free">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_free">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_free</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The free behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;free hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ptr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># free(NULL) is a nop</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="rtn_fwrite">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_fwrite">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_fwrite</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The fwrite behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;fwrite hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">arg3</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">arg1</span> <span class="o">*</span> <span class="n">arg2</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">arg3</span><span class="p">):</span>
        <span class="n">fdesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">arg3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">arg3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">:</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">arg3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stderr</span><span class="p">:</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="n">size</span></div>



<div class="viewcode-block" id="rtn_write">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_write">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_write</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The write behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;write hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
        <span class="n">fdesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fd</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">fd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">:</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">fd</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stderr</span><span class="p">:</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fdesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="n">size</span></div>



<div class="viewcode-block" id="rtn_gettimeofday">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_gettimeofday">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_gettimeofday</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The gettimeofday behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;gettimeofday hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">tv</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tz</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">time_inc_coefficient</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">time</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">tv</span><span class="o">+</span><span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">))</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_malloc">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_malloc">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_malloc</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The malloc behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;malloc hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="n">ptr</span></div>



<div class="viewcode-block" id="rtn_open">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_open">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_open</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The open behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;open hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># const char *pathname</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># int flags</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># we ignore it</span>
    <span class="n">arg0s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>

    <span class="c1"># Concretize the whole path name</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_memory_bytes</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg0s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Concretize the whole string + \0</span>

    <span class="c1"># We use flags as concrete value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Use the flags to open the file in the write mode.</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">:</span>   <span class="c1"># O_RDONLY</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">:</span> <span class="c1"># O_WRONLY</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;w&quot;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">:</span> <span class="c1"># O_RDWR</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;r+&quot;</span>

    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x0100</span><span class="p">:</span> <span class="c1"># O_CREAT</span>
        <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;x&quot;</span>
    <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="mh">0x0200</span><span class="p">:</span> <span class="c1"># O_APPEND</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>  <span class="c1"># replace completely value</span>

    <span class="c1"># enforce using binary mode for open</span>
    <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>

    <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_file_defined</span><span class="p">(</span><span class="n">arg0s</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;r&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>  <span class="c1"># input file and opened in reading</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;opening an input file: </span><span class="si">{</span><span class="n">arg0s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Program is opening an input</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">get_file_input</span><span class="p">(</span><span class="n">arg0s</span><span class="p">)</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">create_file_descriptor</span><span class="p">(</span><span class="n">arg0s</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Try to open it as a regular file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">arg0s</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>  <span class="c1"># use the mode here</span>
            <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">create_file_descriptor</span><span class="p">(</span><span class="n">arg0s</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">id</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to open </span><span class="si">{</span><span class="n">arg0s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span></div>


<div class="viewcode-block" id="rtn_realloc">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_realloc">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_realloc</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The realloc behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;realloc hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">oldptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">oldptr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># malloc behaviour</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ptr</span>

    <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ptr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">ptr</span>

    <span class="k">if</span> <span class="n">ptr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc_pool</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Invalid ptr passed to realloc&quot;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="c1"># This will raise an error</span>

    <span class="n">old_memmap</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc_pool</span><span class="p">[</span><span class="n">oldptr</span><span class="p">]</span>
    <span class="n">old_size</span> <span class="o">=</span> <span class="n">old_memmap</span><span class="o">.</span><span class="n">size</span>
    <span class="n">size_to_copy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">old_size</span><span class="p">)</span>

    <span class="c1">#data = pstate.memory.read(oldptr, size_to_copy)</span>
    <span class="c1">#pstate.memory.write(ptr, data)</span>

    <span class="c1"># Copy bytes symbolically</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size_to_copy</span><span class="p">):</span>
        <span class="n">sym_c</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">oldptr</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">ptr</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_c</span><span class="p">)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">free</span><span class="p">(</span><span class="n">oldptr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ptr</span></div>



<div class="viewcode-block" id="rtn_memcmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_memcmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_memcmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The memcmp behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;memcmp hooked&#39;</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>

    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">)</span>

    <span class="c1"># We constrain the logical value of size</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s1</span><span class="o">+</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s2</span><span class="o">+</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span>
                        <span class="n">cells1</span> <span class="o">==</span> <span class="n">cells2</span><span class="p">,</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">)</span>
                    <span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_memcpy">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_memcpy">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_memcpy</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The memcpy behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;memcpy hooked&#39;</span><span class="p">)</span>

    <span class="n">dst</span><span class="p">,</span> <span class="n">dst_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># We constrain the logical value of size</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnt</span><span class="p">):</span>
        <span class="c1"># Read symbolic src value and copy symbolically in dst</span>
        <span class="n">sym_src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">dst</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_src</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst_ast</span></div>



<div class="viewcode-block" id="rtn_mempcpy">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_mempcpy">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_mempcpy</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The mempcpy behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;mempcpy hooked&#39;</span><span class="p">)</span>

    <span class="n">dst</span><span class="p">,</span> <span class="n">dst_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># We constrain the logical value of size</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnt</span><span class="p">):</span>
        <span class="c1"># Read symbolic src value and copy symbolically in dst</span>
        <span class="n">sym_src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">dst</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_src</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst</span> <span class="o">+</span> <span class="n">cnt</span></div>



<div class="viewcode-block" id="rtn_memmem">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_memmem">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_memmem</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The memmem behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;memmem hooked&#39;</span><span class="p">)</span>

    <span class="n">haystack</span>    <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># const void*</span>
    <span class="n">haystacklen</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># size_t</span>
    <span class="n">needle</span>      <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># const void *</span>
    <span class="n">needlelen</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># size_t</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">haystack</span><span class="p">,</span> <span class="n">haystacklen</span><span class="p">)</span>  <span class="c1"># haystack</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">needlelen</span><span class="p">)</span>      <span class="c1"># needle</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1">#FIXME: faut s&#39;assurer que le marquer dans le string</span>
        <span class="k">return</span> <span class="n">NULL_PTR</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s2</span><span class="p">):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">haystack</span><span class="o">+</span><span class="n">offset</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">needle</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">c2</span><span class="o">.</span><span class="n">getAst</span><span class="p">())</span>

    <span class="c1"># FIXME: à reflechir si on doit contraindre offset ou pas</span>

    <span class="c1"># faut s&#39;assurer que le marquer est bien présent à l&#39;offset trouvé</span>
    <span class="k">return</span> <span class="n">haystack</span> <span class="o">+</span> <span class="n">offset</span></div>



<div class="viewcode-block" id="rtn_memmove">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_memmove">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_memmove</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The memmove behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;memmove hooked&#39;</span><span class="p">)</span>

    <span class="n">dst</span><span class="p">,</span> <span class="n">dst_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># We constrain the logical value of cnt</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># TODO: What if cnt is symbolic ?</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnt</span><span class="p">):</span>
        <span class="c1"># Read symbolic src value and copy symbolically in dst</span>
        <span class="n">sym_src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">dst</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_src</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst_ast</span></div>



<div class="viewcode-block" id="rtn_memset">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_memset">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_memset</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The memset behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;memset hooked&#39;</span><span class="p">)</span>

    <span class="n">dst</span><span class="p">,</span> <span class="n">dst_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">src</span><span class="p">,</span> <span class="n">src_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># We constrain the logical value of size</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">sym_cell</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">src_ast</span><span class="o">.</span><span class="n">getAst</span><span class="p">())</span>

    <span class="c1"># TODO: What if size is symbolic ?</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">dst</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_cell</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst_ast</span></div>



<div class="viewcode-block" id="rtn_printf">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_printf">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_printf</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The printf behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;printf hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">arg0f</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_string</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="n">nbArgs</span> <span class="o">=</span> <span class="n">arg0f</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_arguments</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="p">[</span><span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbArgs</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">arg0f</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># FIXME: Les chars UTF8 peuvent foutre le bordel. Voir avec ground-truth/07.input</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Something wrong, probably UTF-8 string&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">:</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">stdout</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">stdout</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>



<div class="viewcode-block" id="rtn_pthread_create">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_create">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_create</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_create behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_create hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># pthread_t *thread</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># const pthread_attr_t *attr</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># void *(*start_routine) (void *)</span>
    <span class="n">arg3</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># void *arg</span>

    <span class="n">th</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">spawn_new_thread</span><span class="p">(</span><span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>

    <span class="c1"># Save out the thread id</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">th</span><span class="o">.</span><span class="n">tid</span><span class="p">)</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_pthread_exit">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_exit">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_exit</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_exit behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_exit hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Kill the thread</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>

    <span class="c1"># FIXME: I guess the thread exiting never return, so should not continue</span>
    <span class="c1"># FIXME: iterating instructions</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="rtn_pthread_join">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_join">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_join</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_join behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_join hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">arg0</span> <span class="ow">in</span> <span class="n">pstate</span><span class="o">.</span><span class="n">threads</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">join_thread</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thread id </span><span class="si">{</span><span class="n">pstate</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">tid</span><span class="si">}</span><span class="s2"> joined thread id </span><span class="si">{</span><span class="n">arg0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">cancel_join</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Thread id </span><span class="si">{</span><span class="n">arg0</span><span class="si">}</span><span class="s2"> already destroyed&quot;</span><span class="p">)</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_pthread_mutex_destroy">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_mutex_destroy">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_mutex_destroy</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_mutex_destroy behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_mutex_destroy hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># pthread_mutex_t *restrict mutex</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">pstate</span><span class="o">.</span><span class="n">PTHREAD_MUTEX_INIT_MAGIC</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_pthread_mutex_init">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_mutex_init">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_mutex_init</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_mutex_init behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_mutex_init hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># pthread_mutex_t *restrict mutex</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># const pthread_mutexattr_t *restrict attr)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">pstate</span><span class="o">.</span><span class="n">PTHREAD_MUTEX_INIT_MAGIC</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_pthread_mutex_lock">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_mutex_lock">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_mutex_lock</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_mutex_lock behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_mutex_lock hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># pthread_mutex_t *mutex</span>
    <span class="n">mutex</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>  <span class="c1"># deref pointer and read a uint64 int</span>

    <span class="c1"># If the thread has been initialized and unused, define the tid has lock</span>
    <span class="k">if</span> <span class="n">mutex</span> <span class="o">==</span> <span class="n">pstate</span><span class="o">.</span><span class="n">PTHREAD_MUTEX_INIT_MAGIC</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;mutex unlocked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">pstate</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">tid</span><span class="p">)</span>

    <span class="c1"># The mutex is locked and we are not allowed to continue the execution</span>
    <span class="k">elif</span> <span class="n">mutex</span> <span class="o">!=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">tid</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;mutex locked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">mutex_locked</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_pthread_mutex_unlock">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_pthread_mutex_unlock">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_pthread_mutex_unlock</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pthread_mutex_unlock behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;pthread_mutex_unlock hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># pthread_mutex_t *mutex</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">pstate</span><span class="o">.</span><span class="n">PTHREAD_MUTEX_INIT_MAGIC</span><span class="p">)</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_puts">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_puts">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_puts</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The puts behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;puts hooked&#39;</span><span class="p">)</span>

    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_string_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipe_stdout</span><span class="p">:</span>  <span class="c1"># Only perform printing if pipe_stdout activated</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">arg0</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="rtn_rand">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_rand">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_rand</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The rand behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;rand hooked&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">)</span></div>



<div class="viewcode-block" id="rtn_read">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_read">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_read</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The read behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;read hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">fd</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">buff</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">size</span><span class="p">,</span> <span class="n">size_ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_full_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">size_ast</span><span class="o">.</span><span class="n">isSymbolized</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading from the file descriptor (</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s1">) with a symbolic size&#39;</span><span class="p">)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">file_descriptor_exists</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">is_input_fd</span><span class="p">():</span> <span class="c1"># Reading into input</span>
            <span class="c1"># if we started from empty seed simulate reading `size` amount of data</span>
            <span class="k">if</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_raw</span><span class="p">()</span> <span class="ow">and</span> <span class="n">se</span><span class="o">.</span><span class="n">seed</span><span class="o">.</span><span class="n">is_bootstrap_seed</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">size</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>  <span class="c1"># if `size` limited the fgets its an indirect constraint</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">size_ast</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">size</span><span class="p">)</span>

            <span class="n">se</span><span class="o">.</span><span class="n">inject_symbolic_file_memory</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;read in (input) </span><span class="si">{</span><span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File descriptor (</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s1">) not found&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span>  <span class="c1"># todo: set errno</span></div>



<div class="viewcode-block" id="rtn_getchar">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_getchar">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_getchar</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The getchar behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;getchar hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">filedesc</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_file_descriptor</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># stdin</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">offset</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">is_input_fd</span><span class="p">():</span>  <span class="c1"># Reading into input</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># convert to integer</span>
            <span class="n">se</span><span class="o">.</span><span class="n">inject_symbolic_file_register</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">return_register</span><span class="p">,</span> <span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;read in </span><span class="si">{</span><span class="n">filedesc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span></div>



<div class="viewcode-block" id="rtn_sem_destroy">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_destroy">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_destroy</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_destroy behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_destroy hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>

    <span class="c1"># Destroy the semaphore with the value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sem_getvalue">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_getvalue">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_getvalue</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_getvalue behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_getvalue hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># int *sval</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>  <span class="c1"># deref pointer</span>

    <span class="c1"># Set the semaphore&#39;s value into the output</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>  <span class="c1"># WARNING: read uint64 to uint32</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sem_init">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_init">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_init</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_init behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_init hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># int pshared</span>
    <span class="n">arg2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># unsigned int value</span>

    <span class="c1"># Init the semaphore with the value</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sem_post">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_post">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_post</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_post behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_post hooked&#39;</span><span class="p">)</span>

    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>

    <span class="c1"># increments (unlocks) the semaphore pointed to by sem</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sem_timedwait">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_timedwait">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_timedwait</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_timedwait behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_timedwait hooked&#39;</span><span class="p">)</span>

    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>
    <span class="n">arg1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># const struct timespec *abs_timeout</span>

    <span class="c1"># sem_timedwait() is the same as sem_wait(), except that abs_timeout specifies a limit</span>
    <span class="c1"># on the amount of time that the call should block if the decrement cannot be immediately</span>
    <span class="c1"># performed. The abs_timeout argument points to a structure that specifies an absolute</span>
    <span class="c1"># timeout in seconds and nanoseconds since the Epoch, 1970-01-01 00:00:00 +0000 (UTC).</span>
    <span class="c1"># This structure is defined as follows:</span>
    <span class="c1">#</span>
    <span class="c1">#     struct timespec {</span>
    <span class="c1">#         time_t tv_sec;      /* Seconds */</span>
    <span class="c1">#         long   tv_nsec;     /* Nanoseconds [0 .. 999999999] */</span>
    <span class="c1">#     };</span>
    <span class="c1">#</span>
    <span class="c1"># If the timeout has already expired by the time of the call, and the semaphore could not be</span>
    <span class="c1"># locked immediately, then sem_timedwait() fails with a timeout error (errno set to ETIMEDOUT).</span>
    <span class="c1">#</span>
    <span class="c1"># If  the operation can be performed immediately, then sem_timedwait() never fails with a</span>
    <span class="c1"># timeout error, regardless of the value of abs_timeout.  Furthermore, the validity of</span>
    <span class="c1"># abs_timeout is not checked in this case.</span>

    <span class="c1"># TODO: Take into account the abs_timeout argument</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;semaphore still not locked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;semaphore locked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sem_trywait">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_trywait">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_trywait</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_trywait behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_trywait hooked&#39;</span><span class="p">)</span>

    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>

    <span class="c1"># sem_trywait()  is  the  same as sem_wait(), except that if the decrement</span>
    <span class="c1"># cannot be immediately performed, then call returns an error (errno set to</span>
    <span class="c1"># EAGAIN) instead of blocking.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;semaphore still not locked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;semaphore locked but continue&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Setting errno to EAGAIN (3406)</span>
        <span class="n">segs</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">find_map</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">EXTERN_SEG</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">segs</span><span class="p">:</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ERRNO</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="nb">map</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">4</span>  <span class="c1"># Point is last int of the mapping</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_dword</span><span class="p">(</span><span class="n">ERRNO</span><span class="p">,</span> <span class="mi">3406</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>

        <span class="c1"># Return -1</span>
        <span class="k">return</span> <span class="n">pstate</span><span class="o">.</span><span class="n">minus_one</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sem_wait">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sem_wait">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sem_wait</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sem_wait behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sem_wait hooked&#39;</span><span class="p">)</span>

    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># sem_t *sem</span>

    <span class="c1"># decrements (locks) the semaphore pointed to by sem. If the semaphore&#39;s value</span>
    <span class="c1"># is greater than zero, then the decrement proceeds, and the function returns,</span>
    <span class="c1"># immediately. If the semaphore currently has the value zero, then the call blocks</span>
    <span class="c1"># until either it becomes possible to perform the decrement (i.e., the semaphore</span>
    <span class="c1"># value rises above zero).</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;semaphore still not locked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;semaphore locked&#39;</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Return success</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sleep">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sleep">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sleep</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sleep behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sleep hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">se</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skip_sleep_routine</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="c1"># Return value</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_sprintf">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_sprintf">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_sprintf</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The sprintf behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;sprintf hooked&#39;</span><span class="p">)</span>

    <span class="c1"># Get arguments</span>
    <span class="n">buff</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arg0f</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_string</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
        <span class="n">nbArgs</span> <span class="o">=</span> <span class="n">arg0f</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_format_arguments</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="p">[</span><span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">nbArgs</span><span class="o">+</span><span class="mi">2</span><span class="p">)])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">arg0f</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># FIXME: Les chars UTF8 peuvent foutre le bordel. Voir avec ground-truth/07.input</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Something wrong, probably UTF-8 string&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># FIXME: todo</span>

    <span class="c1"># FIXME: THIS SEEMS NOT OK</span>
    <span class="c1"># for index, c in enumerate(s):</span>
    <span class="c1">#     pstate.tt_ctx.concretizeMemory(buff + index)</span>
    <span class="c1">#     pstate.tt_ctx.setConcreteMemoryValue(buff + index, ord(c))</span>
    <span class="c1">#     pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(buff + index, 1)) == ord(c))</span>
    <span class="c1">#</span>
    <span class="c1"># # including the terminating null byte (&#39;\0&#39;)</span>
    <span class="c1"># pstate.tt_ctx.setConcreteMemoryValue(buff + len(s), 0x00)</span>
    <span class="c1"># pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(buff + len(s), 1)) == 0x00)</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>



<div class="viewcode-block" id="rtn_strcasecmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strcasecmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strcasecmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strcasecmp behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strcasecmp hooked&#39;</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s1</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1">#s = s1 if len(pstate.memory.read_string(s1)) &lt; len(pstate.memory.read_string(s2)) else s2</span>
    <span class="c1">#for i in range(size):</span>
    <span class="c1">#    pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s1 + i, CPUSIZE.BYTE)) != 0x00)</span>
    <span class="c1">#    pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s2 + i, CPUSIZE.BYTE)) != 0x00)</span>
    <span class="c1">#pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s + size, CPUSIZE.BYTE)) == 0x00)</span>
    <span class="c1">#pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s1 + len(pstate.memory.read_string(s1)), CPUSIZE.BYTE)) == 0x00)</span>
    <span class="c1">#pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s2 + len(pstate.memory.read_string(s2)), CPUSIZE.BYTE)) == 0x00)</span>

    <span class="c1"># FIXME: Il y a des truc chelou avec le +1 et le logic ci-dessous</span>

    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s1</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s2</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells1</span> <span class="o">&gt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">cells1</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)]),</span> <span class="n">cells1</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="n">cells1</span><span class="p">)</span> <span class="c1"># upper case</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells2</span> <span class="o">&gt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">cells2</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)]),</span> <span class="n">cells2</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="n">cells2</span><span class="p">)</span> <span class="c1"># upper case</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">cells1</span> <span class="o">==</span> <span class="n">cells2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_strchr">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strchr">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strchr</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strchr behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strchr hooked&#39;</span><span class="p">)</span>

    <span class="n">string</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">char</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ast</span>    <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>

    <span class="k">def</span> <span class="nf">rec</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">maxdeep</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="o">==</span> <span class="n">maxdeep</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="n">deep</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">res</span>  <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="p">(</span><span class="n">char</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="n">deep</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">rec</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">deep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxdeep</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="n">sze</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">rec</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sze</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">string</span><span class="p">)):</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">string</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">string</span><span class="o">+</span><span class="n">sze</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_strcmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strcmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strcmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strcmp behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strcmp hooked&#39;</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s1</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="c1">#s = s1 if len(pstate.memory.read_string(s1)) &lt;= len(pstate.memory.read_string(s2)) else s2</span>
    <span class="c1">#for i in range(size):</span>
    <span class="c1">#    pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s1 + i, CPUSIZE.BYTE)) != 0x00)</span>
    <span class="c1">#    pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s2 + i, CPUSIZE.BYTE)) != 0x00)</span>
    <span class="c1">#pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s + size, CPUSIZE.BYTE)) == 0x00)</span>
    <span class="c1">#pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s1 + len(pstate.memory.read_string(s1)), CPUSIZE.BYTE)) == 0x00)</span>
    <span class="c1">#pstate.tt_ctx.pushPathConstraint(pstate.tt_ctx.getMemoryAst(MemoryAccess(s2 + len(pstate.memory.read_string(s2)), CPUSIZE.BYTE)) == 0x00)</span>

    <span class="c1"># FIXME: Il y a des truc chelou avec le +1 et le logic ci-dessous</span>

    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s1</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s2</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">cells1</span> <span class="o">==</span> <span class="n">cells2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_strcpy">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strcpy">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strcpy</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strcpy behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strcpy hooked&#39;</span><span class="p">)</span>

    <span class="n">dst</span>  <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">src</span>  <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_str</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_str</span><span class="p">)</span>

    <span class="c1"># constraint src buff to be != \00 and last one to be \00 (indirectly concretize length)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">src_str</span><span class="p">):</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span>

    <span class="c1"># Copy symbolically bytes (including \00)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">sym_c</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">dst</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_c</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst</span></div>



<div class="viewcode-block" id="rtn_strdup">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strdup">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strdup</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strdup behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strdup hooked&#39;</span><span class="p">)</span>

    <span class="n">s</span>  <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s_str</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_str</span><span class="p">)</span>

    <span class="c1">#print(f&quot;strdup s={s:#x} s_str={s_str} size={size}&quot;)</span>

    <span class="c1"># constrain src buff to be != \00 and last one to be \00 (indirectly concretize length)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s_str</span><span class="p">):</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span>


    <span class="c1"># Malloc a chunk</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Copy symbolically bytes (including \00)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">sym_c</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">ptr</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">sym_c</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ptr</span></div>



<div class="viewcode-block" id="rtn_strerror">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strerror">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strerror</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strerror behavior.</span>

<span class="sd">    :param se: The current symbolic execution instance</span>
<span class="sd">    :param pstate: The current process state</span>
<span class="sd">    :return: a concrete value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strerror hooked&#39;</span><span class="p">)</span>

    <span class="n">sys_errlist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">b</span><span class="s2">&quot;Success&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Operation not permitted&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No such file or directory&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No such process&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Interrupted system call&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Input/output error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No such device or address&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Argument list too long&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Exec format error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Bad file descriptor&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No child processes&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Resource temporarily unavailable&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Cannot allocate memory&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Permission denied&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Bad address&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Block device required&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Device or resource busy&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;File exists&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid cross-device link&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No such device&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Not a directory&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Is a directory&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid argument&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Too many open files in system&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Too many open files&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Inappropriate ioctl for device&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Text file busy&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;File too large&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No space left on device&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Illegal seek&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Read-only file system&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Too many links&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Broken pipe&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Numerical argument out of domain&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Numerical result out of range&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Resource deadlock avoided&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;File name too long&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No locks available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Function not implemented&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Directory not empty&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Too many levels of symbolic links&quot;</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No message of desired type&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Identifier removed&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Channel number out of range&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Level 2 not synchronized&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Level 3 halted&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Level 3 reset&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Link number out of range&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Protocol driver not attached&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No CSI structure available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Level 2 halted&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid exchange&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid request descriptor&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Exchange full&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No anode&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid request code&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid slot&quot;</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Bad font file format&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Device not a stream&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No data available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Timer expired&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Out of streams resources&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Machine is not on the network&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Package not installed&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Object is remote&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Link has been severed&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Advertise error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Srmount error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Communication error on send&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Protocol error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Multihop attempted&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;RFS specific error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Bad message&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Value too large for defined data type&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Name not unique on network&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;File descriptor in bad state&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Remote address changed&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Can not access a needed shared library&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Accessing a corrupted shared library&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;.lib section in a.out corrupted&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Attempting to link in too many shared libraries&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Cannot exec a shared library directly&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Invalid or incomplete multibyte or wide character&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Interrupted system call should be restarted&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Streams pipe error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Too many users&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Socket operation on non-socket&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Destination address required&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Message too long&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Protocol wrong type for socket&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Protocol not available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Protocol not supported&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Socket type not supported&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Operation not supported&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Protocol family not supported&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Address family not supported by protocol&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Address already in use&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Cannot assign requested address&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Network is down&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Network is unreachable&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Network dropped connection on reset&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Software caused connection abort&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Connection reset by peer&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No buffer space available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Transport endpoint is already connected&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Transport endpoint is not connected&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Cannot send after transport endpoint shutdown&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Too many references: cannot splice&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Connection timed out&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Connection refused&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Host is down&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No route to host&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Operation already in progress&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Operation now in progress&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Stale NFS file handle&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Structure needs cleaning&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Not a XENIX named type file&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No XENIX semaphores available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Is a named type file&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Remote I/O error&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Disk quota exceeded&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;No medium found&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Wrong medium type&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Operation canceled&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Required key not available&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Key has expired&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Key has been revoked&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Key was rejected by service&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;Owner died&quot;</span><span class="p">,</span>
        <span class="sa">b</span><span class="s2">&quot;State not recoverable&quot;</span>
    <span class="p">]</span>

    <span class="c1"># Get arguments</span>
    <span class="n">errnum</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="n">sys_errlist</span><span class="p">[</span><span class="n">errnum</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># invalid errnum</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Error&#39;</span>

    <span class="c1"># TODO: We allocate the string at every hit of this function with a</span>
    <span class="c1"># potential memory leak. We should allocate the sys_errlist only once</span>
    <span class="c1"># and then refer to this table instead of allocate string.</span>
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">heap_allocator</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="nb">str</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ptr</span></div>



<div class="viewcode-block" id="rtn_strlen">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strlen">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strlen</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strlen behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strlen hooked&#39;</span><span class="p">)</span>

    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>

    <span class="c1"># Get arguments</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>

    <span class="c1"># FIXME: Not so sure its is really the strlen semantic</span>
    <span class="k">def</span> <span class="nf">rec</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">deep</span><span class="p">,</span> <span class="n">maxdeep</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="o">==</span> <span class="n">maxdeep</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">deep</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">res</span>  <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="n">deep</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">rec</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">deep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxdeep</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="n">sze</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="n">sze</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">rec</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sze</span><span class="p">)</span>

    <span class="c1"># FIXME: That routine should do something like below to be SOUND !</span>
    <span class="c1"># for i, c in enumerate(pstate.memory.read_string(src)):</span>
    <span class="c1">#     pstate.push_constraint(pstate.read_symbolic_memory_byte(src + i) != 0x00)</span>
    <span class="c1"># pstate.push_constraint(pstate.read_symbolic_memory_byte(src + size) == 0x00)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">sze</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_strncasecmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strncasecmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strncasecmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strncasecmp behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strncasecmp hooked&#39;</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sz</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s1</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>

    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxlen</span><span class="p">):</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s1</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s2</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells1</span> <span class="o">&gt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">cells1</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)]),</span> <span class="n">cells1</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="n">cells1</span><span class="p">)</span> <span class="c1"># upper case</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">cells2</span> <span class="o">&gt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="n">cells2</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)]),</span> <span class="n">cells2</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="n">cells2</span><span class="p">)</span> <span class="c1"># upper case</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">cells1</span> <span class="o">==</span> <span class="n">cells2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_strncmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strncmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strncmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strncmp behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strncmp hooked&#39;</span><span class="p">)</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sz</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sz</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s1</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">s2</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>

    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxlen</span><span class="p">):</span>
        <span class="n">cells1</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s1</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">cells2</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">s2</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">cells1</span> <span class="o">==</span> <span class="n">cells2</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_strncpy">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strncpy">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strncpy</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strncpy behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strncpy hooked&#39;</span><span class="p">)</span>

    <span class="n">dst</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnt</span><span class="p">):</span>
        <span class="n">src_sym</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">src</span><span class="o">+</span><span class="n">index</span><span class="p">)</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">write_symbolic_memory_byte</span><span class="p">(</span><span class="n">dst</span><span class="o">+</span><span class="n">index</span><span class="p">,</span> <span class="n">src_sym</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">src_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">src_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">src_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">!=</span> <span class="mh">0x00</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dst</span></div>



<div class="viewcode-block" id="rtn_strtok_r">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strtok_r">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strtok_r</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strtok_r behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strtok_r hooked&#39;</span><span class="p">)</span>

    <span class="n">string</span>  <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">delim</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">saveptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">saveMem</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">saveptr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">saveMem</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="c1"># TODO: Make it symbolic</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="c1"># Init the \0 at the delimiter position</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">lor</span><span class="p">([</span><span class="n">node</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>  <span class="c1"># dafuck is that?</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">node</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

            <span class="c1"># Token must not contain delimiters</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">delim</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">node</span> <span class="o">!=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">delim</span><span class="p">))</span>

            <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_char</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Save the pointer</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">saveptr</span><span class="p">,</span> <span class="n">string</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Return the token</span>
            <span class="k">return</span> <span class="n">string</span> <span class="o">+</span> <span class="n">offset</span>

    <span class="k">return</span> <span class="n">NULL_PTR</span></div>



<div class="viewcode-block" id="rtn_strtoul">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_strtoul">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_strtoul</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The strtoul behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;strtoul hooked&#39;</span><span class="p">)</span>

    <span class="n">nptr</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nptrs</span>  <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_string_argument</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">endptr</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">base</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nptrs</span><span class="p">):</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">nptr</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="n">pstate</span><span class="o">.</span><span class="n">concretize_argument</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Concretize base</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">nptrs</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mh">0xffffffff</span></div>



<div class="viewcode-block" id="rtn_getenv">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_getenv">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_getenv</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The getenv behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">NULL_PTR</span>

    <span class="n">environ_name</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target called getenv(</span><span class="si">{</span><span class="n">environ_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">host_env_val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">environ_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">host_env_val</span> <span class="k">if</span> <span class="n">host_env_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span></div>



<span class="c1">#def rtn_tolower(se: &#39;SymbolicExecutor&#39;, pstate: &#39;ProcessState&#39;):</span>
<span class="c1">#    # TODO</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    The tolower behavior.</span>
<span class="c1">#    &quot;&quot;&quot;</span>
<span class="c1">#    ptr_bit_size = pstate.ptr_bit_size</span>
<span class="c1">#    ast = pstate.actx</span>
<span class="c1">#    arg_sym = pstate.get_argument_symbolic(0)</span>
<span class="c1">#    return rdi_sym.getAst() - 0x20</span>

<div class="viewcode-block" id="rtn_isspace">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_isspace">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_isspace</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The isspace behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ptr_bit_size</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_bit_size</span>
    <span class="n">ast</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">actx</span>
    <span class="n">arg_sym</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_symbolic</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">exp</span> <span class="o">=</span> <span class="n">arg_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x20</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">lor</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">arg_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xa</span><span class="p">])</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">lor</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">arg_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x9</span><span class="p">])</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">lor</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">arg_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xc</span><span class="p">])</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">lor</span><span class="p">([</span><span class="n">exp</span><span class="p">,</span> <span class="n">arg_sym</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xd</span><span class="p">])</span>
    <span class="n">res</span> <span class="o">=</span>  <span class="n">ast</span><span class="o">.</span><span class="n">ite</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">bv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ptr_bit_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>



<div class="viewcode-block" id="rtn_assert_fail">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_assert_fail">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_assert_fail</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The __assert_fail behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__assert_fail called : </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Write 1 as return value of the program</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">return_register</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">se</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span></div>


<div class="viewcode-block" id="rtn_setlocale">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_setlocale">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_setlocale</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The setlocale behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;setlocale hooked&#39;</span><span class="p">)</span>

    <span class="n">category</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">locale</span>   <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">locale</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to modify Locale. Currently not supported.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># This is a bit hacky but we just store the LOCALEs in the [extern] segment</span>
    <span class="n">segs</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">find_map</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">EXTERN_SEG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">segs</span><span class="p">:</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">LC_ALL</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="nb">map</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mh">0x20</span> <span class="c1"># Point to the end of seg. But keep in mind LC_ALL is at end - 4.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;selocale writing at </span><span class="si">{</span><span class="n">LC_ALL</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;en_US.UTF-8</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;setlocale called with unsupported category=</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">LC_ALL</span></div>



<div class="viewcode-block" id="rtn__setjmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn__setjmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn__setjmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The _setjmp behavior. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;hooked _setjmp&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<div class="viewcode-block" id="rtn_longjmp">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_longjmp">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_longjmp</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The longjmp behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE All the programs tested so far used `longjmp` as an error handling mechanism, right</span>
    <span class="c1"># before exiting. This is why, `longjmp` is currently considered an exit condition. </span>
    <span class="c1"># TODO Real implementation</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;longjmp hooked&#39;</span><span class="p">)</span>
    <span class="n">pstate</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="rtn_atexit">
<a class="viewcode-back" href="../../dev_doc/routines.html#tritondse.routines.rtn_atexit">[docs]</a>
<span class="k">def</span> <span class="nf">rtn_atexit</span><span class="p">(</span><span class="n">se</span><span class="p">:</span> <span class="s1">&#39;SymbolicExecutor&#39;</span><span class="p">,</span> <span class="n">pstate</span><span class="p">:</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">0</span></div>



<span class="n">SUPPORTED_ROUTINES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># TODO:</span>
    <span class="c1">#   - tolower</span>
    <span class="c1">#   - toupper</span>
    <span class="s1">&#39;__assert_fail&#39;</span><span class="p">:</span>           <span class="n">rtn_assert_fail</span><span class="p">,</span>
    <span class="s1">&#39;__ctype_b_loc&#39;</span><span class="p">:</span>           <span class="n">rtn_ctype_b_loc</span><span class="p">,</span>
    <span class="s1">&#39;__ctype_toupper_loc&#39;</span><span class="p">:</span>     <span class="n">rtn_ctype_toupper_loc</span><span class="p">,</span>
    <span class="s1">&#39;__errno_location&#39;</span><span class="p">:</span>        <span class="n">rtn_errno_location</span><span class="p">,</span>
    <span class="s1">&#39;__fprintf_chk&#39;</span><span class="p">:</span>           <span class="n">rtn___fprintf_chk</span><span class="p">,</span>
    <span class="s1">&#39;__libc_start_main&#39;</span><span class="p">:</span>       <span class="n">rtn_libc_start_main</span><span class="p">,</span>
    <span class="s1">&#39;__stack_chk_fail&#39;</span><span class="p">:</span>        <span class="n">rtn_stack_chk_fail</span><span class="p">,</span>
    <span class="s1">&#39;__xstat&#39;</span><span class="p">:</span>                 <span class="n">rtn_xstat</span><span class="p">,</span>
    <span class="s1">&#39;abort&#39;</span><span class="p">:</span>                   <span class="n">rtn_abort</span><span class="p">,</span>
    <span class="s2">&quot;atexit&quot;</span><span class="p">:</span>                  <span class="n">rtn_atexit</span><span class="p">,</span>
    <span class="s2">&quot;__cxa_atexit&quot;</span><span class="p">:</span>            <span class="n">rtn_atexit</span><span class="p">,</span>
    <span class="s1">&#39;atoi&#39;</span><span class="p">:</span>                    <span class="n">rtn_atoi</span><span class="p">,</span>
    <span class="s1">&#39;calloc&#39;</span><span class="p">:</span>                  <span class="n">rtn_calloc</span><span class="p">,</span>
    <span class="s1">&#39;clock_gettime&#39;</span><span class="p">:</span>           <span class="n">rtn_clock_gettime</span><span class="p">,</span>
    <span class="s1">&#39;exit&#39;</span><span class="p">:</span>                    <span class="n">rtn_exit</span><span class="p">,</span>
    <span class="s1">&#39;fclose&#39;</span><span class="p">:</span>                  <span class="n">rtn_fclose</span><span class="p">,</span>
    <span class="s1">&#39;fgets&#39;</span><span class="p">:</span>                   <span class="n">rtn_fgets</span><span class="p">,</span>
    <span class="s1">&#39;fopen&#39;</span><span class="p">:</span>                   <span class="n">rtn_fopen</span><span class="p">,</span>
    <span class="s1">&#39;fprintf&#39;</span><span class="p">:</span>                 <span class="n">rtn_fprintf</span><span class="p">,</span>
    <span class="s1">&#39;fputc&#39;</span><span class="p">:</span>                   <span class="n">rtn_fputc</span><span class="p">,</span>
    <span class="s1">&#39;fputs&#39;</span><span class="p">:</span>                   <span class="n">rtn_fputs</span><span class="p">,</span>
    <span class="s1">&#39;fread&#39;</span><span class="p">:</span>                   <span class="n">rtn_fread</span><span class="p">,</span>
    <span class="s1">&#39;free&#39;</span><span class="p">:</span>                    <span class="n">rtn_free</span><span class="p">,</span>
    <span class="s1">&#39;fwrite&#39;</span><span class="p">:</span>                  <span class="n">rtn_fwrite</span><span class="p">,</span>
    <span class="s1">&#39;gettimeofday&#39;</span><span class="p">:</span>            <span class="n">rtn_gettimeofday</span><span class="p">,</span>
    <span class="s1">&#39;malloc&#39;</span><span class="p">:</span>                  <span class="n">rtn_malloc</span><span class="p">,</span>
    <span class="s1">&#39;memcmp&#39;</span><span class="p">:</span>                  <span class="n">rtn_memcmp</span><span class="p">,</span>
    <span class="s1">&#39;memcpy&#39;</span><span class="p">:</span>                  <span class="n">rtn_memcpy</span><span class="p">,</span>
    <span class="s1">&#39;memmem&#39;</span><span class="p">:</span>                  <span class="n">rtn_memmem</span><span class="p">,</span>
    <span class="s1">&#39;memmove&#39;</span><span class="p">:</span>                 <span class="n">rtn_memmove</span><span class="p">,</span>
    <span class="s1">&#39;memset&#39;</span><span class="p">:</span>                  <span class="n">rtn_memset</span><span class="p">,</span>
    <span class="s1">&#39;open&#39;</span><span class="p">:</span>                    <span class="n">rtn_open</span><span class="p">,</span>
    <span class="s1">&#39;printf&#39;</span><span class="p">:</span>                  <span class="n">rtn_printf</span><span class="p">,</span>
    <span class="s1">&#39;pthread_create&#39;</span><span class="p">:</span>          <span class="n">rtn_pthread_create</span><span class="p">,</span>
    <span class="s1">&#39;pthread_exit&#39;</span><span class="p">:</span>            <span class="n">rtn_pthread_exit</span><span class="p">,</span>
    <span class="s1">&#39;pthread_join&#39;</span><span class="p">:</span>            <span class="n">rtn_pthread_join</span><span class="p">,</span>
    <span class="s1">&#39;pthread_mutex_destroy&#39;</span><span class="p">:</span>   <span class="n">rtn_pthread_mutex_destroy</span><span class="p">,</span>
    <span class="s1">&#39;pthread_mutex_init&#39;</span><span class="p">:</span>      <span class="n">rtn_pthread_mutex_init</span><span class="p">,</span>
    <span class="s1">&#39;pthread_mutex_lock&#39;</span><span class="p">:</span>      <span class="n">rtn_pthread_mutex_lock</span><span class="p">,</span>
    <span class="s1">&#39;pthread_mutex_unlock&#39;</span><span class="p">:</span>    <span class="n">rtn_pthread_mutex_unlock</span><span class="p">,</span>
    <span class="s1">&#39;puts&#39;</span><span class="p">:</span>                    <span class="n">rtn_puts</span><span class="p">,</span>
    <span class="s1">&#39;rand&#39;</span><span class="p">:</span>                    <span class="n">rtn_rand</span><span class="p">,</span>
    <span class="s1">&#39;read&#39;</span><span class="p">:</span>                    <span class="n">rtn_read</span><span class="p">,</span>
    <span class="s1">&#39;sem_destroy&#39;</span><span class="p">:</span>             <span class="n">rtn_sem_destroy</span><span class="p">,</span>
    <span class="s1">&#39;sem_getvalue&#39;</span><span class="p">:</span>            <span class="n">rtn_sem_getvalue</span><span class="p">,</span>
    <span class="s1">&#39;sem_init&#39;</span><span class="p">:</span>                <span class="n">rtn_sem_init</span><span class="p">,</span>
    <span class="s1">&#39;sem_post&#39;</span><span class="p">:</span>                <span class="n">rtn_sem_post</span><span class="p">,</span>
    <span class="s1">&#39;sem_timedwait&#39;</span><span class="p">:</span>           <span class="n">rtn_sem_timedwait</span><span class="p">,</span>
    <span class="s1">&#39;sem_trywait&#39;</span><span class="p">:</span>             <span class="n">rtn_sem_trywait</span><span class="p">,</span>
    <span class="s1">&#39;sem_wait&#39;</span><span class="p">:</span>                <span class="n">rtn_sem_wait</span><span class="p">,</span>
    <span class="s1">&#39;sleep&#39;</span><span class="p">:</span>                   <span class="n">rtn_sleep</span><span class="p">,</span>
    <span class="s1">&#39;sprintf&#39;</span><span class="p">:</span>                 <span class="n">rtn_sprintf</span><span class="p">,</span>
    <span class="s1">&#39;strcasecmp&#39;</span><span class="p">:</span>              <span class="n">rtn_strcasecmp</span><span class="p">,</span>
    <span class="s1">&#39;strchr&#39;</span><span class="p">:</span>                  <span class="n">rtn_strchr</span><span class="p">,</span>
    <span class="s1">&#39;strcmp&#39;</span><span class="p">:</span>                  <span class="n">rtn_strcmp</span><span class="p">,</span>
    <span class="s1">&#39;strcpy&#39;</span><span class="p">:</span>                  <span class="n">rtn_strcpy</span><span class="p">,</span>
    <span class="s1">&#39;strerror&#39;</span><span class="p">:</span>                <span class="n">rtn_strerror</span><span class="p">,</span>
    <span class="s1">&#39;strlen&#39;</span><span class="p">:</span>                  <span class="n">rtn_strlen</span><span class="p">,</span>
    <span class="s1">&#39;strncasecmp&#39;</span><span class="p">:</span>             <span class="n">rtn_strncasecmp</span><span class="p">,</span>
    <span class="s1">&#39;strncmp&#39;</span><span class="p">:</span>                 <span class="n">rtn_strncmp</span><span class="p">,</span>
    <span class="s1">&#39;strncpy&#39;</span><span class="p">:</span>                 <span class="n">rtn_strncpy</span><span class="p">,</span>
    <span class="s1">&#39;strtok_r&#39;</span><span class="p">:</span>                <span class="n">rtn_strtok_r</span><span class="p">,</span>
    <span class="s1">&#39;strtoul&#39;</span><span class="p">:</span>                 <span class="n">rtn_strtoul</span><span class="p">,</span>

    <span class="s1">&#39;write&#39;</span><span class="p">:</span>                   <span class="n">rtn_write</span><span class="p">,</span>
    <span class="s1">&#39;getenv&#39;</span><span class="p">:</span>                  <span class="n">rtn_getenv</span><span class="p">,</span>
    <span class="s1">&#39;fseek&#39;</span><span class="p">:</span>                   <span class="n">rtn_fseek</span><span class="p">,</span>
    <span class="s1">&#39;ftell&#39;</span><span class="p">:</span>                   <span class="n">rtn_ftell</span><span class="p">,</span>

    <span class="s1">&#39;_setjmp&#39;</span><span class="p">:</span>                 <span class="n">rtn__setjmp</span><span class="p">,</span>
    <span class="s1">&#39;longjmp&#39;</span><span class="p">:</span>                 <span class="n">rtn_longjmp</span><span class="p">,</span>
    <span class="s1">&#39;realloc&#39;</span><span class="p">:</span>                 <span class="n">rtn_realloc</span><span class="p">,</span>
    <span class="s1">&#39;setlocale&#39;</span><span class="p">:</span>               <span class="n">rtn_setlocale</span><span class="p">,</span>
    <span class="s1">&#39;strdup&#39;</span><span class="p">:</span>                  <span class="n">rtn_strdup</span><span class="p">,</span>
    <span class="s1">&#39;mempcpy&#39;</span><span class="p">:</span>                 <span class="n">rtn_mempcpy</span><span class="p">,</span>
    <span class="s1">&#39;__mempcpy&#39;</span><span class="p">:</span>               <span class="n">rtn_mempcpy</span><span class="p">,</span>
    <span class="s1">&#39;getchar&#39;</span><span class="p">:</span>                 <span class="n">rtn_getchar</span><span class="p">,</span>

    <span class="s1">&#39;isspace&#39;</span><span class="p">:</span>                 <span class="n">rtn_isspace</span><span class="p">,</span>
    <span class="c1">#&#39;tolower&#39;:                 rtn_tolower,</span>
<span class="p">}</span>


<span class="n">SUPORTED_GVARIABLES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;__stack_chk_guard&#39;</span><span class="p">:</span>    <span class="mh">0xdead</span><span class="p">,</span>
    <span class="s1">&#39;stderr&#39;</span><span class="p">:</span>               <span class="mh">0x0002</span><span class="p">,</span>
    <span class="s1">&#39;stdin&#39;</span><span class="p">:</span>                <span class="mh">0x0000</span><span class="p">,</span>
    <span class="s1">&#39;stdout&#39;</span><span class="p">:</span>               <span class="mh">0x0001</span><span class="p">,</span>
<span class="p">}</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Quarkslab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>