<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tritondse.process_state &mdash; TritonDSE 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TritonDSE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/starting.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/hooks.html">Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/seeds.html">Seeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/sanitizers.html">Sanitizers &amp; Probes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutos/loaders.html">Loaders</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/callbacks.html">Callback Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/coverage.html">Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/executor.html">SymbolicExecutor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/explorator.html">SymbolicExplorator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/exception.html">Exception</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/loaders.html">Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/process.html">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/sanitizers.html">Sanitizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/seeds.html">Seed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracing.html">Trace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/types.html">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/workspace.html">Workspace</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Practicals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../practicals/toy_example.html">Toy Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../practicals/json_parser.html">JSON Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../practicals/crackme.html">Crackme</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_doc/routines.html">Supported Routines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_doc/seedscheduling.html">Seed Scheduling</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TritonDSE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tritondse.process_state</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tritondse.process_state</h1><div class="highlight"><pre>
<span></span><span class="c1"># built-ins</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>


<span class="c1"># third-party</span>
<span class="c1"># import z3  # For direct value enumeration</span>
<span class="kn">from</span> <span class="nn">triton</span> <span class="kn">import</span> <span class="n">TritonContext</span><span class="p">,</span> <span class="n">MemoryAccess</span><span class="p">,</span> <span class="n">CALLBACK</span><span class="p">,</span> <span class="n">CPUSIZE</span><span class="p">,</span> <span class="n">Instruction</span><span class="p">,</span> <span class="n">MODE</span><span class="p">,</span> <span class="n">AST_NODE</span><span class="p">,</span> <span class="n">SOLVER</span><span class="p">,</span> <span class="n">EXCEPTION</span>

<span class="c1"># local imports</span>
<span class="kn">from</span> <span class="nn">tritondse.thread_context</span> <span class="kn">import</span> <span class="n">ThreadContext</span>
<span class="kn">from</span> <span class="nn">tritondse.heap_allocator</span> <span class="kn">import</span> <span class="n">HeapAllocator</span>
<span class="kn">from</span> <span class="nn">tritondse.types</span> <span class="kn">import</span> <span class="n">Architecture</span><span class="p">,</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">ByteSize</span><span class="p">,</span> <span class="n">BitSize</span><span class="p">,</span> <span class="n">PathConstraint</span><span class="p">,</span> <span class="n">Register</span><span class="p">,</span> <span class="n">Expression</span><span class="p">,</span> \
                            <span class="n">AstNode</span><span class="p">,</span> <span class="n">Registers</span><span class="p">,</span> <span class="n">SolverStatus</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">SymbolicVariable</span><span class="p">,</span> <span class="n">ArchMode</span><span class="p">,</span> <span class="n">Perm</span><span class="p">,</span> <span class="n">FileDesc</span><span class="p">,</span> <span class="n">Endian</span>
<span class="kn">from</span> <span class="nn">tritondse.arch</span> <span class="kn">import</span> <span class="n">ARCHS</span><span class="p">,</span> <span class="n">CpuState</span>
<span class="kn">from</span> <span class="nn">tritondse.loaders</span> <span class="kn">import</span> <span class="n">Loader</span>
<span class="kn">from</span> <span class="nn">tritondse.memory</span> <span class="kn">import</span> <span class="n">Memory</span><span class="p">,</span> <span class="n">MemoryAccessViolation</span>
<span class="kn">import</span> <span class="nn">tritondse.logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">tritondse</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>


<div class="viewcode-block" id="ProcessState"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState">[docs]</a><span class="k">class</span> <span class="nc">ProcessState</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current process state. This class keeps all the runtime related to a running</span>
<span class="sd">    process, namely current, instruction, thread, memory maps, file descriptors etc.</span>
<span class="sd">    It also wraps Triton execution and thus hold its context. At the top of this,</span>
<span class="sd">    it provides a user-friendly API to access data in both the concrete and symbolic</span>
<span class="sd">    state of Triton.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">STACK_SEG</span> <span class="o">=</span> <span class="s2">&quot;[stack]&quot;</span>
    <span class="n">EXTERN_SEG</span> <span class="o">=</span> <span class="s2">&quot;[extern]&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endianness</span><span class="p">:</span> <span class="n">Endian</span> <span class="o">=</span> <span class="n">Endian</span><span class="o">.</span><span class="n">LITTLE</span><span class="p">,</span> <span class="n">time_inc_coefficient</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param endianness: Endianness to consider</span>
<span class="sd">        :param time_inc_coefficient: Time coefficient to represent execution time of an</span>
<span class="sd">                                     instruction see: :py:attr:`tritondse.Config.time_inc_coefficient`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># EXTERN_BASE is a &quot;fake&quot; memory area (not mapped) that will</span>
        <span class="c1"># which addresses will be used for external symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXTERN_FUNC_BASE</span> <span class="o">=</span> <span class="mh">0x01000000</span>  <span class="c1"># Not PLT but a dummy address space containing pointers to external symbols</span>

        <span class="c1"># This range will be dynamically allocated</span>
        <span class="c1"># upon request.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BASE_HEAP</span> <span class="o">=</span> <span class="mh">0x10000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">END_HEAP</span> <span class="o">=</span> <span class="mh">0x6fffffff</span>

        <span class="c1"># The Triton&#39;s context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span> <span class="o">=</span> <span class="n">TritonContext</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TritonContext object&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="p">:</span> <span class="s1">&#39;AstContext&#39;</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getAstContext</span><span class="p">()</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Triton `AstContext &lt;https://triton-library.github.io/documentation/doxygen/py_AstContext_page.html&gt;`_</span>
<span class="sd">        enabling crafting logical expressions to be solved by SMT</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Cpu object wrapping registers values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">:</span> <span class="n">CpuState</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: CpuState holding concrete values of registers *(initialized when calling load)*</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Memory object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span> <span class="n">Memory</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="p">,</span> <span class="n">endianness</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Memory object associated with the ProcessState &quot;&quot;&quot;</span>

        <span class="c1"># Used to define that the process must exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Signals table used by raise(), signal(), etc.</span>
        <span class="c1">#self.signals_table = dict()</span>

        <span class="c1"># Dynamic symbols name -&gt; addr (where they are mapped)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_symbol_table</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Addr</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionnary of dynamic symbols as retrieved during the loading&quot;&quot;&quot;</span>

        <span class="c1"># File descriptors table used by fopen(), fprintf(), etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fd_table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="n">FileDesc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;stdin&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">),</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">FileDesc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;stdout&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">),</span>
            <span class="mi">2</span><span class="p">:</span> <span class="n">FileDesc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;stderr&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="c1"># Unique file id incrementation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fd_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd_table</span><span class="p">)</span>

        <span class="c1"># Allocation information used by malloc()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap_allocator</span><span class="p">:</span> <span class="n">HeapAllocator</span> <span class="o">=</span> <span class="n">HeapAllocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BASE_HEAP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">END_HEAP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allocator providing alloc, free primitives atop the Memory object&quot;&quot;&quot;</span>

        <span class="c1"># Unique thread id incrementation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utid</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Current thread id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utid</span>

        <span class="c1"># Threads contexts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threads</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tid</span><span class="p">:</span> <span class="n">ThreadContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tid</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Thread mutext init magic number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PTHREAD_MUTEX_INIT_MAGIC</span> <span class="o">=</span> <span class="mh">0xdead</span>

        <span class="c1"># Mutex and semaphore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutex_locked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">semaphore_locked</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># The time when the ProcessState is instancied.</span>
        <span class="c1"># It&#39;s used to provide a deterministic behavior when calling functions</span>
        <span class="c1"># like gettimeofday(), clock_gettime(), etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Configuration values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endianness</span> <span class="o">=</span> <span class="n">endianness</span>  <span class="c1">#: Current endianness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_inc_coefficient</span> <span class="o">=</span> <span class="n">time_inc_coefficient</span>

        <span class="c1"># Runtime temporary variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pcs_updated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># The current instruction executed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_inst</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># The memory mapping of the program ({vaddr_s : vaddr_e})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__program_segments_mapping</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ThreadContext</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives a list of all threads currently active.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_threads</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ThreadContext</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives the current thread selected.</span>

<span class="sd">        :return: current thread</span>
<span class="sd">        :rtype: ThreadContext</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tid</span><span class="p">]</span>

<div class="viewcode-block" id="ProcessState.switch_thread"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.switch_thread">[docs]</a>    <span class="k">def</span> <span class="nf">switch_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thread</span><span class="p">:</span> <span class="n">ThreadContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the current thread to the one given in parameter.</span>
<span class="sd">        Thus save the current context, and restore the one of the</span>
<span class="sd">        thread given in parameter. It also resets the counter of</span>
<span class="sd">        the thread restored. If the current_thread is dead, it will</span>
<span class="sd">        also remove it !</span>

<span class="sd">        :param thread: thread to restore ThreadContext</span>
<span class="sd">        :return: True if the switch worked fine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">tid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">is_dead</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_tid</span><span class="p">]</span>
                <span class="c1"># TODO: Finding all other threads joining it / (or locked by it ?) to unlock them</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Do a normal switch</span>
                <span class="c1"># Reset the counter and save its context</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="p">)</span>

            <span class="c1"># Schedule to the next thread</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Reset the counter</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tid</span> <span class="o">=</span> <span class="n">thread</span><span class="o">.</span><span class="n">tid</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while doing context switch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ProcessState.spawn_new_thread"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.spawn_new_thread">[docs]</a>    <span class="k">def</span> <span class="nf">spawn_new_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_pc</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Addr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ThreadContext</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new thread in the process state. Parameters are the</span>
<span class="sd">        new program counter and a pointer to arguments to provide the thread.</span>

<span class="sd">        :param new_pc: new program counter (function to execution)</span>
<span class="sd">        :param args: arguments</span>
<span class="sd">        :return: thread context newly created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_unique_thread_id</span><span class="p">()</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">ThreadContext</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="p">)</span>

        <span class="c1"># Concretize pc, bp, sp, and first (argument)</span>
        <span class="n">regs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">program_counter_register</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack_pointer_register</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_pointer_register</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_argument_register</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">regs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reg</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">in</span> <span class="n">thread</span><span class="o">.</span><span class="n">sregs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">thread</span><span class="o">.</span><span class="n">sregs</span><span class="p">[</span><span class="n">reg</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span>

        <span class="n">thread</span><span class="o">.</span><span class="n">cregs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">program_counter_register</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">new_pc</span>  <span class="c1"># set new pc</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">cregs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_argument_register</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">args</span>   <span class="c1"># set args pointer</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">map_from_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STACK_SEG</span><span class="p">)</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">cregs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_pointer_register</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">((</span><span class="n">stack</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="n">stack</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">*</span> <span class="n">tid</span><span class="p">))</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">cregs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stack_pointer_register</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">((</span><span class="n">stack</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="n">stack</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">*</span> <span class="n">tid</span><span class="p">))</span>

        <span class="c1"># Add the thread in the pool of threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threads</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">thread</span>
        <span class="k">return</span> <span class="n">thread</span></div>

<div class="viewcode-block" id="ProcessState.set_triton_mode"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.set_triton_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_triton_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">MODE</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the given mode in the TritonContext.</span>

<span class="sd">        :param mode: mode to set in triton context</span>
<span class="sd">        :param value: value to set (default True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.set_thumb"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.set_thumb">[docs]</a>    <span class="k">def</span> <span class="nf">set_thumb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set thumb mode activated in the TritonContext. The mode will automatically</span>
<span class="sd">        be switched during execution, but at initialization this method enable</span>
<span class="sd">        activating it / disabling it. (Disabled be default)</span>

<span class="sd">        :param enable: bool: Wether or not to active thumb</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setThumb</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.set_solver_timeout"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.set_solver_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">set_solver_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the timeout for all subsequent queries.</span>

<span class="sd">        :param timeout: timeout in milliseconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setSolverTimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.set_solver"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.set_solver">[docs]</a>    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SOLVER</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the SMT solver to use in the background.</span>

<span class="sd">        :param solver: Solver to use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">SOLVER</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">SOLVER</span><span class="o">.</span><span class="n">Z3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setSolver</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_unique_thread_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new unique thread id. Used by thread related functions when spawning a new thread.</span>

<span class="sd">        :returns: new thread identifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utid</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utid</span>

<div class="viewcode-block" id="ProcessState.create_file_descriptor"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.create_file_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">create_file_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileDesc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new file descriptor out of a name.</span>

<span class="sd">        :param name: name of the file</span>
<span class="sd">        :param file: object to read from</span>
<span class="sd">        :return: FileDesc object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_fd_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fd_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fd_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="n">FileDesc</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">new_fd_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">fd</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fd_table</span><span class="p">[</span><span class="n">new_fd_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">filedesc</span>
        <span class="k">return</span> <span class="n">filedesc</span></div>

<div class="viewcode-block" id="ProcessState.close_file_descriptor"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.close_file_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">close_file_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the given file descriptor id.</span>

<span class="sd">        :param id: id of the file descriptor</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filedesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fd_table</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filedesc</span><span class="o">.</span><span class="n">fd</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">):</span>
            <span class="n">filedesc</span><span class="o">.</span><span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessState.get_file_descriptor"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_file_descriptor">[docs]</a>    <span class="k">def</span> <span class="nf">get_file_descriptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileDesc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the given file descriptor.</span>

<span class="sd">        :raise KeyError: if the file descriptor is not found</span>
<span class="sd">        :param id: id of the file descriptor</span>
<span class="sd">        :return: FileDesc object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fd_table</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ProcessState.file_descriptor_exists"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.file_descriptor_exists">[docs]</a>    <span class="k">def</span> <span class="nf">file_descriptor_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether the file descriptor has been defined or not.</span>

<span class="sd">        :param id: id of the file descriptor</span>
<span class="sd">        :return: True if the id is found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fd_table</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">architecture</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Architecture</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Architecture of the current process state</span>

<span class="sd">        :return: Architecture set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Architecture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getArchitecture</span><span class="p">())</span>

    <span class="nd">@architecture</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">architecture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arch</span><span class="p">:</span> <span class="n">Architecture</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the architecture of the process state.</span>
<span class="sd">        Internal set it in the TritonContext</span>

<span class="sd">        :param arch: Architecture to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setArchitecture</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ptr_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ByteSize</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Size of a pointer in bytes</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getGprSize</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ptr_bit_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BitSize</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Size of a pointer in bits</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.BitSize`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getGprBitSize</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">minus_one</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Value -1 according to the architecture size (32 or 64 bits)</span>

<span class="sd">        :return: -1 as an unsigned Python integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_bit_size</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">registers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Registers</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All registers according to the current architecture defined.</span>
<span class="sd">        The object returned is the TritonContext.register object.</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.Registers`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">return_register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Register</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the appropriate return register according to the arch.</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.Register`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">ret_reg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">program_counter_register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Register</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the appropriate pc register according to the arch.</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.Register`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">pc_reg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_pointer_register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Register</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the appropriate base pointer register according to the arch.</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.Register`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">bp_reg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stack_pointer_register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Register</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the appropriate stack pointer register according to the arch.</span>

<span class="sd">        :rtype: :py:obj:`tritondse.types.Register`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">sp_reg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_syscall_register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Register</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return the appropriate syscall id register according to the arch &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">sys_reg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_argument_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Register</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the appropriate register according to the arch.</span>

<span class="sd">        :raise: IndexError If the index is out of arguments bound</span>
<span class="sd">        :return: Register</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">reg_args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<div class="viewcode-block" id="ProcessState.initialize_context"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.initialize_context">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arch</span><span class="p">:</span> <span class="n">Architecture</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the context with the given architecture</span>

<span class="sd">        .. todo:: Protecting that function</span>

<span class="sd">        :param arch: The architecture to initialize</span>
<span class="sd">        :type arch: Architecture</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span> <span class="o">=</span> <span class="n">arch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span> <span class="o">=</span> <span class="n">ARCHS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="n">CpuState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.unpack_integer"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.unpack_integer">[docs]</a>    <span class="k">def</span> <span class="nf">unpack_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpack the given bytes into into integer value respecting</span>
<span class="sd">        size given and endianness.</span>

<span class="sd">        :param data: bytes data to unpack</span>
<span class="sd">        :param size: size in bits of data to unpack</span>
<span class="sd">        :return: integer value unpacked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianness</span> <span class="o">==</span> <span class="n">Endian</span><span class="o">.</span><span class="n">LITTLE</span> <span class="k">else</span> <span class="s2">&quot;&gt;&quot;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="p">{</span><span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">}</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">tab</span><span class="p">[</span><span class="n">size</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ProcessState.pack_integer"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.pack_integer">[docs]</a>    <span class="k">def</span> <span class="nf">pack_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unpack the given bytes into into integer value respecting</span>
<span class="sd">        size given and endianness.</span>

<span class="sd">        :param data: bytes data to unpack</span>
<span class="sd">        :param size: size in bits of data to unpack</span>
<span class="sd">        :return: integer value packed as bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endianness</span> <span class="o">==</span> <span class="n">Endian</span><span class="o">.</span><span class="n">LITTLE</span> <span class="k">else</span> <span class="s2">&quot;&gt;&quot;</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="p">{</span><span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="mi">64</span><span class="p">:</span> <span class="s1">&#39;Q&#39;</span><span class="p">}</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">tab</span><span class="p">[</span><span class="n">size</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.read_register"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.read_register">[docs]</a>    <span class="k">def</span> <span class="nf">read_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the current concrete value of the given register.</span>

<span class="sd">        :param register: string of the register or Register object</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        :return: Integer value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>  <span class="c1"># if str transform to reg</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getConcreteRegisterValue</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.write_register"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.write_register">[docs]</a>    <span class="k">def</span> <span class="nf">write_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the current concrete value of the given register.</span>

<span class="sd">        :param register: string of the register or Register object</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        :param value: integer value to assign in the register</span>
<span class="sd">        :type value: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>  <span class="c1"># if str transform to reg</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setConcreteRegisterValue</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.register_triton_callback"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.register_triton_callback">[docs]</a>    <span class="k">def</span> <span class="nf">register_triton_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb_type</span><span class="p">:</span> <span class="n">CALLBACK</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register the given ``callback`` as triton callback to hook memory/registers</span>
<span class="sd">        read/writes.</span>

<span class="sd">        :param cb_type: Callback enum type as defined by Triton</span>
<span class="sd">        :type cb_type: `CALLBACK &lt;https://triton.quarkslab.com/documentation/doxygen/py_CALLBACK_page.html&gt;`_</span>
<span class="sd">        :param callback: routines to call on the given event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">cb_type</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.clear_triton_callbacks"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.clear_triton_callbacks">[docs]</a>    <span class="k">def</span> <span class="nf">clear_triton_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all registered callbacks in triton.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">clearCallbacks</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessState.is_heap_ptr"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.is_heap_ptr">[docs]</a>    <span class="k">def</span> <span class="nf">is_heap_ptr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether a given address is pointing in the heap area.</span>

<span class="sd">        :param ptr: Address to check</span>
<span class="sd">        :type ptr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :return: True if pointer points to the heap area *(allocated or not)*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BASE_HEAP</span> <span class="o">&lt;=</span> <span class="n">ptr</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">END_HEAP</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ProcessState.is_syscall"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.is_syscall">[docs]</a>    <span class="k">def</span> <span class="nf">is_syscall</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the current instrution fetched is a syscall or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_instruction</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">syscall_inst</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.fetch_instruction"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.fetch_instruction">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="n">Addr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">set_as_current</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">disable_callbacks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Instruction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch the instruction at the given address. If no address</span>
<span class="sd">        is specified the current program counter one is used.</span>

<span class="sd">        :raise MemoryAccessViolation: If the instruction cannot be fetched in the memory.</span>

<span class="sd">        :param address: address where to get the instruction from</span>
<span class="sd">        :param set_as_current: set as the current instruction in the process state</span>
<span class="sd">        :param disable_callbacks: whether memory callbacks should be disabled to fetch memory bytes</span>
<span class="sd">        :return: instruction disassembled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">address</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">program_counter</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">without_segmentation</span><span class="p">(</span><span class="n">disable_callbacks</span><span class="o">=</span><span class="n">disable_callbacks</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">Instruction</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">i</span><span class="o">.</span><span class="n">setThreadId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">tid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">disassembly</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># This needs to be done before using i.getSize()</span>
                                    <span class="c1"># otherwise, i.getSize() will always be 16</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">segmentation_enabled</span><span class="p">:</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">getSize</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemoryAccessViolation</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">Perm</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">memory_not_mapped</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Perm</span><span class="o">.</span><span class="n">X</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">map</span><span class="o">.</span><span class="n">perm</span><span class="p">:</span>  <span class="c1"># Note: in this model we can execute code in non-readable pages</span>
                <span class="k">raise</span> <span class="n">MemoryAccessViolation</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">Perm</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">map_perm</span><span class="o">=</span><span class="nb">map</span><span class="o">.</span><span class="n">perm</span><span class="p">,</span> <span class="n">perm_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">set_as_current</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_inst</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">return</span> <span class="n">i</span></div>

<div class="viewcode-block" id="ProcessState.process_instruction"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.process_instruction">[docs]</a>    <span class="k">def</span> <span class="nf">process_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction</span><span class="p">:</span> <span class="n">Instruction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the given triton instruction on this process state.</span>

<span class="sd">        :param instruction: Triton Instruction object</span>
<span class="sd">        :type instruction: `Instruction &lt;https://triton.quarkslab.com/documentation/doxygen/py_Instruction_page.html&gt;`_</span>
<span class="sd">        :return: True if the processing of the instruction succeeded (False otherwise)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__pcs_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">__len_pcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getPathPredicateSize</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">instruction</span><span class="o">.</span><span class="n">getDisassembly</span><span class="p">():</span>  <span class="c1"># If the insrtuction has not been disassembled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">disassembly</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__current_inst</span> <span class="o">=</span> <span class="n">instruction</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">buildSemantics</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>

        <span class="c1"># Simulate that the time of an executed instruction is time_inc_coefficient.</span>
        <span class="c1"># For example, if time_inc_coefficient is 0.0001, it means that an instruction</span>
        <span class="c1"># takes 100us to be executed. Used to provide a deterministic behavior when</span>
        <span class="c1"># calling time functions (e.g gettimeofday(), clock_gettime(), ...).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_inc_coefficient</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getPathPredicateSize</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">__len_pcs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__pcs_updated</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">ret</span> <span class="o">==</span> <span class="n">EXCEPTION</span><span class="o">.</span><span class="n">NO_FAULT</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path_predicate_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the size of the path predicate (conjonction</span>
<span class="sd">        of all branches and additionnals constraints added)</span>

<span class="sd">        :return: size of the predicate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getPathPredicateSize</span><span class="p">()</span>

<div class="viewcode-block" id="ProcessState.is_path_predicate_updated"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.is_path_predicate_updated">[docs]</a>    <span class="k">def</span> <span class="nf">is_path_predicate_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return whether or not the path predicate has been updated &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pcs_updated</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_branch_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PathConstraint</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the last PathConstraint object added in the path predicate.</span>
<span class="sd">        Should be called after :py:meth:`is_path_predicate_updated`.</span>

<span class="sd">        :raise IndexError: if the path predicate is empty</span>
<span class="sd">        :return: the path constraint object as returned by Triton</span>
<span class="sd">        :rtype: `PathConstraint &lt;https://triton.quarkslab.com/documentation/doxygen/py_PathConstraint_page.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getPathConstraints</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Instruction</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The current instruction being executed. *(None if not set yet)*</span>

<span class="sd">        :rtype: Optional[`Instruction &lt;https://triton.quarkslab.com/documentation/doxygen/py_Instruction_page.html&gt;`_]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_inst</span>

<div class="viewcode-block" id="ProcessState.is_register_symbolic"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.is_register_symbolic">[docs]</a>    <span class="k">def</span> <span class="nf">is_register_symbolic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether the register is symbolic or not.</span>

<span class="sd">        :param register: register string, or Register object</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        :return: True if the register is symbolic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getRegisterAst</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">.</span><span class="n">isSymbolized</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessState.read_symbolic_register"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.read_symbolic_register">[docs]</a>    <span class="k">def</span> <span class="nf">read_symbolic_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the symbolic expression associated with the given register.</span>

<span class="sd">        :param register: register string, or Register object</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        :return: SymbolicExpression of the register as returned by Triton</span>
<span class="sd">        :rtype: `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>  <span class="c1"># if str transform to reg</span>
        <span class="n">sym_reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getSymbolicRegister</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sym_reg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">reg</span><span class="o">.</span><span class="n">getBitSize</span><span class="p">()</span> <span class="o">!=</span> <span class="n">sym_reg</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span><span class="o">.</span><span class="n">getBitvectorSize</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getRegisterAst</span><span class="p">(</span><span class="n">reg</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sym_reg</span></div>

<div class="viewcode-block" id="ProcessState.write_symbolic_register"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.write_symbolic_register">[docs]</a>    <span class="k">def</span> <span class="nf">write_symbolic_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">],</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">Expression</span><span class="p">],</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign the given symbolic expression to the register. The given expression can either be a SMT AST node</span>
<span class="sd">        or directly an Expression (SymbolicExpression).</span>

<span class="sd">        :param register: register identifier (str or Register)</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        :param expr: expression to assign (`AstNode &lt;https://triton.quarkslab.com/documentation/doxygen/py_AstNode_page.html&gt;`_</span>
<span class="sd">               or `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_)</span>
<span class="sd">        :param comment: Comment to add on the symbolic expression created</span>
<span class="sd">        :type comment: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>  <span class="c1"># if str transform to reg</span>
        <span class="n">exp</span> <span class="o">=</span> <span class="n">expr</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s2">&quot;getAst&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;assign </span><span class="si">{</span><span class="n">reg</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">exp</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span><span class="o">.</span><span class="n">evaluate</span><span class="p">())</span>  <span class="c1"># Update concrete state to keep sync</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">assignSymbolicExpressionToRegister</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.read_symbolic_memory_int"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.read_symbolic_memory_int">[docs]</a>    <span class="k">def</span> <span class="nf">read_symbolic_memory_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new Symbolic Expression representing the whole memory range given in parameter.</span>
<span class="sd">        That function should not be used on big memory chunks.</span>

<span class="sd">        :param addr: Memory address</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: memory size in bytes</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        :raise RuntimeError: If the size if not aligned</span>
<span class="sd">        :return: Symbolic Expression associated with the memory</span>
<span class="sd">        :rtype: `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]:</span>
            <span class="n">ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getMemoryAst</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="n">ast</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;size should be aligned [1, 2, 4, 8, 16, 32, 64] (bytes)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.read_symbolic_memory_byte"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.read_symbolic_memory_byte">[docs]</a>    <span class="k">def</span> <span class="nf">read_symbolic_memory_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin wrapper to retrieve the symbolic expression of a single bytes in memory.</span>

<span class="sd">        :param addr: Memory address</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :return: Symbolic Expression associated with the memory</span>
<span class="sd">        :rtype: `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getSymbolicMemory</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getMemoryAst</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="ProcessState.read_symbolic_memory_bytes"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.read_symbolic_memory_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">read_symbolic_memory_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new Symbolic Expression representing the whole memory range given in parameter.</span>
<span class="sd">        That function should not be used on big memory chunks.</span>

<span class="sd">        :param addr: Memory address</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: memory size in bytes</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        :return: Symbolic Expression associated with the memory</span>
<span class="sd">        :rtype: `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_memory_byte</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Need to create a per-byte expression with concat</span>
            <span class="n">asts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getMemoryAst</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">CPUSIZE</span><span class="o">.</span><span class="n">BYTE</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
            <span class="n">concat_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">asts</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="n">concat_expr</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.write_symbolic_memory_int"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.write_symbolic_memory_int">[docs]</a>    <span class="k">def</span> <span class="nf">write_symbolic_memory_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign the given symbolic expression representing an integer to the given address.</span>
<span class="sd">        That function should not be used on big memory chunks.</span>

<span class="sd">        :param addr: Memory address</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: memory size in bytes</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        :param expr: expression to assign (`AstNode &lt;https://triton.quarkslab.com/documentation/doxygen/py_AstNode_page.html&gt;`_</span>
<span class="sd">                     or `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_)</span>
<span class="sd">        :raise RuntimeError: if the size if not aligned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s2">&quot;getAst&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;assign memory&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setConcreteMemoryValue</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="n">expr</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span><span class="o">.</span><span class="n">evaluate</span><span class="p">())</span>  <span class="c1"># To keep the concrete state synchronized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">assignSymbolicExpressionToMemory</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;size should be aligned [1, 2, 4, 8, 16, 32, 64] (bytes)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.write_symbolic_memory_byte"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.write_symbolic_memory_byte">[docs]</a>    <span class="k">def</span> <span class="nf">write_symbolic_memory_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a single bytes symbolic at the given address</span>

<span class="sd">        .. NOTE: We purposefully not provide a way to assign in memory a symbolic expression of</span>
<span class="sd">           arbitrary size as it would imply doing many extract on the given expression. For buffer</span>
<span class="sd">           you should do it in a per-byte manner with this method.</span>

<span class="sd">        :param addr: Memory address</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param expr: byte expression to assign (`AstNode &lt;https://triton.quarkslab.com/documentation/doxygen/py_AstNode_page.html&gt;`_</span>
<span class="sd">                     or `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s2">&quot;getAst&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">newSymbolicExpression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;assign memory&quot;</span><span class="p">)</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">ast</span><span class="o">.</span><span class="n">getBitvectorSize</span><span class="p">()</span> <span class="o">==</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setConcreteMemoryValue</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">CPUSIZE</span><span class="o">.</span><span class="n">BYTE</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">evaluate</span><span class="p">())</span>  <span class="c1"># Keep concrete state synced</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">assignSymbolicExpressionToMemory</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">CPUSIZE</span><span class="o">.</span><span class="n">BYTE</span><span class="p">))</span></div>

<div class="viewcode-block" id="ProcessState.is_memory_symbolic"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.is_memory_symbolic">[docs]</a>    <span class="k">def</span> <span class="nf">is_memory_symbolic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate the symbolic memory and returns whether or not at least one byte of the buffer</span>
<span class="sd">        is symbolic</span>

<span class="sd">        :param addr: Memory address</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: size of the memory range to check</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        :return: True if at least one byte of the memory is symbolic, false otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">addr</span><span class="o">+</span><span class="n">size</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">isMemorySymbolized</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ProcessState.push_constraint"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.push_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">push_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">AstNode</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Thin wrapper on the triton context underneath to add a path constraint.</span>

<span class="sd">        :param constraint: Constraint expression to add</span>
<span class="sd">        :type constraint: `AstNode &lt;https://triton.quarkslab.com/documentation/doxygen/py_AstNode_page.html&gt;`_</span>
<span class="sd">        :param comment: String comment to attach to the constraint</span>
<span class="sd">        :type comment: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">pushPathConstraint</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.get_path_constraints"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_path_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PathConstraint</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of all path constraints set in the Triton context.</span>

<span class="sd">        :return: list of constraints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getPathConstraints</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessState.concretize_register"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.concretize_register">[docs]</a>    <span class="k">def</span> <span class="nf">concretize_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concretize the given register with its current concrete value.</span>
<span class="sd">        **This operation is sound** as it will also add a path constraint</span>
<span class="sd">        to enforce that the symbolic register value is equal to its concrete</span>
<span class="sd">        value.</span>

<span class="sd">        :param register: Register identifier (str or Register)</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">isRegisterSymbolized</span><span class="p">(</span><span class="n">reg</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_register</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span></div>
        <span class="c1"># Else do not even push the constraint</span>

<div class="viewcode-block" id="ProcessState.concretize_memory_bytes"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.concretize_memory_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">concretize_memory_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concretize the given memory with its current concrete value.</span>
<span class="sd">        **This operation is sound** and allows restraining the memory</span>
<span class="sd">        value to its constant value.</span>

<span class="sd">        :param addr: Address to concretize</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: Size of the integer to concretize</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_memory_symbolic</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_memory_bytes</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">data</span><span class="p">)</span></div>
        <span class="c1"># else do not even push the constraint</span>

<div class="viewcode-block" id="ProcessState.concretize_memory_int"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.concretize_memory_int">[docs]</a>    <span class="k">def</span> <span class="nf">concretize_memory_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concretize the given memory with its current concrete value.</span>
<span class="sd">        **This operation is sound** and allows restraining the memory</span>
<span class="sd">        value to its constant value.</span>

<span class="sd">        :param addr: Address to concretize</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: Size of the integer to concretize</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_uint</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">isMemorySymbolized</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_constraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_memory_int</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span></div>
        <span class="c1"># else do not even push the constraint</span>

<div class="viewcode-block" id="ProcessState.concretize_argument"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.concretize_argument">[docs]</a>    <span class="k">def</span> <span class="nf">concretize_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concretize the given function parameter following the calling convention</span>
<span class="sd">        of the architecture.</span>

<span class="sd">        :param index: Argument index</span>
<span class="sd">        :type index: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concretize_register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_argument_register</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">reg_args</span><span class="p">)</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span> <span class="o">+</span> <span class="p">((</span><span class="n">index</span><span class="o">-</span><span class="n">len_args</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span>  <span class="c1"># Retrieve stack address</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">concretize_memory_int</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span>                     <span class="c1"># Concretize the value at this addr</span></div>

<div class="viewcode-block" id="ProcessState.write_argument_value"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.write_argument_value">[docs]</a>    <span class="k">def</span> <span class="nf">write_argument_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the parameter index with the given value. It will take in account</span>
<span class="sd">        whether the argument is in a register or the stack.</span>

<span class="sd">        :param i: Ith argument of the function</span>
<span class="sd">        :param val: integer value of the parameter</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_argument_register</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">reg_args</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_stack_value</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">len_args</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.get_argument_value"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_argument_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_argument_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the integer value of parameters following the call convention.</span>
<span class="sd">        The value originate either from a register or the stack depending</span>
<span class="sd">        on the ith argument requested.</span>

<span class="sd">        :param i: Ith argument of the function</span>
<span class="sd">        :type i: int</span>
<span class="sd">        :return: integer value of the parameter</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_argument_register</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">reg_args</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stack_value</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">len_args</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.get_argument_symbolic"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_argument_symbolic">[docs]</a>    <span class="k">def</span> <span class="nf">get_argument_symbolic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the symbolic expression associated with the given ith parameter.</span>

<span class="sd">        :param i: Ith function parameter</span>
<span class="sd">        :return: Symbolic expression associated</span>
<span class="sd">        :rtype: `SymbolicExpression &lt;https://triton.quarkslab.com/documentation/doxygen/py_SymbolicExpression_page.html&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_argument_register</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">reg_args</span><span class="p">)</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span><span class="o">-</span><span class="n">len_args</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_symbolic_memory_int</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.get_full_argument"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_full_argument">[docs]</a>    <span class="k">def</span> <span class="nf">get_full_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Expression</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get both the concrete argument value along with its symbolic expression.</span>

<span class="sd">        :return: Tuple containing concrete value and symbolic expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_argument_symbolic</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.get_string_argument"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_string_argument">[docs]</a>    <span class="k">def</span> <span class="nf">get_string_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a string for which address is a function parameter.</span>
<span class="sd">        The function first get the argument value, and then dereference</span>
<span class="sd">        the string located at that address.</span>

<span class="sd">        :param idx: argument index</span>
<span class="sd">        :type idx: int</span>
<span class="sd">        :returns: memory string</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_argument_value</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span></div>

<div class="viewcode-block" id="ProcessState.get_format_string"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_format_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_format_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a formatted string in Python format from a format string</span>
<span class="sd">        located in memory at ``addr``.</span>

<span class="sd">        :param addr: Address to concretize</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>                                             \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%#02x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:#02x}</span><span class="s2">&quot;</span><span class="p">)</span>     \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%#x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:#x}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:x}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02X</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:02X}</span><span class="s2">&quot;</span><span class="p">)</span> \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%c</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:c}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:02x}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%ld</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>    \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%*s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%lX</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:X}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%08x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:08x}</span><span class="s2">&quot;</span><span class="p">)</span>     \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%u</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%lu</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%zu&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>           \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%02u</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%03u</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:03d}</span><span class="s2">&quot;</span><span class="p">)</span>                     \
               <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%03d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:03d}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%p&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{:#x}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.get_format_arguments"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_format_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">get_format_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt_addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the format string at ``fmt_addr``. For each format item</span>
<span class="sd">        which are strings, dereference that associated string and replaces it</span>
<span class="sd">        in ``args``.</span>

<span class="sd">        :param fmt_addr: Address to concretize</span>
<span class="sd">        :type fmt_addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param args: Parameters associated with the format string</span>
<span class="sd">        :type args: List[int]</span>
<span class="sd">        :rtype: List[Union[int, str]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># FIXME: Modifies inplace args (which is not very nice)</span>
        <span class="n">s_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">fmt_addr</span><span class="p">)</span>
        <span class="n">postString</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">s_str</span><span class="p">[</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;s&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">postString</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_string</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
            <span class="n">args</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="ProcessState.get_stack_value"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_stack_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_stack_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value at the ith position further in the stack</span>

<span class="sd">        :param index: The index position from the top of the stack</span>
<span class="sd">        :type index: int</span>
<span class="sd">        :param offset: An integer value offset to apply to stack address</span>
<span class="sd">        :type offset: int</span>
<span class="sd">        :return: the value got</span>
<span class="sd">        :return: the value got</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_uint</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.write_stack_value"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.write_stack_value">[docs]</a>    <span class="k">def</span> <span class="nf">write_stack_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the given value on the stack at the given index relative to the current</span>
<span class="sd">        stack pointer. The index value can be positive to write further down the stack</span>
<span class="sd">        or negative to write upward.</span>

<span class="sd">        :param index: The index position from the top of the stack</span>
<span class="sd">        :type index: int</span>
<span class="sd">        :param value: Integer value to write on the stack</span>
<span class="sd">        :type value: int</span>
<span class="sd">        :param offset: Add an optional ith item offset to add to stack value (not a size)</span>
<span class="sd">        :type offset: int</span>
<span class="sd">        :return: the value got</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_int</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.pop_stack_value"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.pop_stack_value">[docs]</a>    <span class="k">def</span> <span class="nf">pop_stack_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop a stack value, and the re-increment the stack pointer value.</span>
<span class="sd">        This operation is fully concrete.</span>

<span class="sd">        :return: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="ProcessState.push_stack_value"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.push_stack_value">[docs]</a>    <span class="k">def</span> <span class="nf">push_stack_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Push a stack value. It then decreement the stack pointer value.</span>

<span class="sd">        :param value: The value to push</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">stack_pointer</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptr_size</span></div>

<div class="viewcode-block" id="ProcessState.is_halt_instruction"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.is_halt_instruction">[docs]</a>    <span class="k">def</span> <span class="nf">is_halt_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the the current instruction is corresponding to an &#39;halt&#39; instruction</span>
<span class="sd">        in the target architecture.</span>

<span class="sd">        :returns: Return true if on halt instruction architecture independent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">halt_opc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archinfo</span><span class="o">.</span><span class="n">halt_inst</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_inst</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="n">halt_opc</span></div>

<div class="viewcode-block" id="ProcessState.solve"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">AstNode</span><span class="p">]],</span> <span class="n">with_pp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SolverStatus</span><span class="p">,</span> <span class="n">Model</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solve the given constraint one the current symbolic state and returns both</span>
<span class="sd">        a Solver status and a model. If not SAT the model returned is empty. Argument</span>
<span class="sd">        ``with_pp`` enables checking the constraint taking in account the path predicate.</span>

<span class="sd">        :param constraint: AstNode or list of AstNodes constraints to solve</span>
<span class="sd">        :param with_pp: whether to take in account path predicate</span>
<span class="sd">        :return: tuple of status and model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">with_pp</span><span class="p">:</span>
            <span class="n">cst</span> <span class="o">=</span> <span class="n">constraint</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">constraint</span><span class="p">]</span>
            <span class="n">final_cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getPathPredicate</span><span class="p">()]</span><span class="o">+</span><span class="n">cst</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">land</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">constraint</span>

        <span class="n">model</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getModel</span><span class="p">(</span><span class="n">final_cst</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">SolverStatus</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="n">model</span></div>

<div class="viewcode-block" id="ProcessState.solve_no_pp"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.solve_no_pp">[docs]</a>    <span class="k">def</span> <span class="nf">solve_no_pp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">AstNode</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SolverStatus</span><span class="p">,</span> <span class="n">Model</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function that solve a constraint forcing not to use</span>
<span class="sd">        the path predicate.</span>

<span class="sd">        .. warning:: Solving a query without the path predicate gives theoretically</span>
<span class="sd">                     unsound results.</span>

<span class="sd">        :param constraint: AstNode constraint to solve</span>
<span class="sd">        :return: tuple of status and model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">with_pp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessState.symbolize_register"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.symbolize_register">[docs]</a>    <span class="k">def</span> <span class="nf">symbolize_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Register</span><span class="p">],</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SymbolicVariable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Symbolize the given register. This a proxy for the symbolizeRegister</span>
<span class="sd">        Triton function.</span>

<span class="sd">        :param register: string of the register or Register object</span>
<span class="sd">        :type register: Union[str, :py:obj:`tritondse.types.Register`]</span>
<span class="sd">        :param alias: alias name to give to the symbolic variable</span>
<span class="sd">        :type alias: str</span>
<span class="sd">        :return: Triton Symbolic variable created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">registers</span><span class="p">,</span> <span class="n">register</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">register</span>  <span class="c1"># if str get reg</span>
        <span class="k">if</span> <span class="n">alias</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">symbolizeRegister</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">symbolizeRegister</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span></div>

<div class="viewcode-block" id="ProcessState.symbolize_memory_byte"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.symbolize_memory_byte">[docs]</a>    <span class="k">def</span> <span class="nf">symbolize_memory_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SymbolicVariable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Symbolize the given memory cell. Returns the associated</span>
<span class="sd">        SymbolicVariable</span>

<span class="sd">        :param addr: Address to symbolize</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param alias: alias to give the variable</span>
<span class="sd">        :return: newly created symbolic variable</span>
<span class="sd">        :rtype: :py:obj:`tritondse.types.SymbolicVariable`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alias</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">symbolizeMemory</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">CPUSIZE</span><span class="o">.</span><span class="n">BYTE</span><span class="p">),</span> <span class="n">alias</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">symbolizeMemory</span><span class="p">(</span><span class="n">MemoryAccess</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">CPUSIZE</span><span class="o">.</span><span class="n">BYTE</span><span class="p">))</span></div>

<div class="viewcode-block" id="ProcessState.symbolize_memory_bytes"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.symbolize_memory_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">symbolize_memory_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">ByteSize</span><span class="p">,</span> <span class="n">alias_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SymbolicVariable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Symbolize a range of memory addresses. Can optionally provide an alias</span>
<span class="sd">        prefix.</span>

<span class="sd">        :param addr: Address at which to read data</span>
<span class="sd">        :type addr: :py:obj:`tritondse.types.Addr`</span>
<span class="sd">        :param size: Number of bytes to symbolize</span>
<span class="sd">        :type size: :py:obj:`tritondse.types.ByteSize`</span>
<span class="sd">        :param alias_prefix: prefix name to give the variable</span>
<span class="sd">        :type alias_prefix: str</span>
<span class="sd">        :return: list of Symbolic variables created</span>
<span class="sd">        :rtype: List[:py:obj:`tritondse.types.SymbolicVariable`]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alias_prefix</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolize_memory_byte</span><span class="p">(</span><span class="n">addr</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">alias_prefix</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="n">offset</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolize_memory_byte</span><span class="p">(</span><span class="n">addr</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span></div>

<div class="viewcode-block" id="ProcessState.get_expression_variable_values_model"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.get_expression_variable_values_model">[docs]</a>    <span class="k">def</span> <span class="nf">get_expression_variable_values_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">Expression</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">SymbolicVariable</span><span class="p">:</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a symbolic expression and a model, returns the valuation</span>
<span class="sd">        of all variables involved in the expression.</span>

<span class="sd">        :param exp: Symbolic Expression to look into</span>
<span class="sd">        :param model: Model generated by the solver</span>
<span class="sd">        :return: dictionnary of symbolic variables and their associated value (as int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="s2">&quot;getAst&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">exp</span>
        <span class="n">ast_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">AST_NODE</span><span class="o">.</span><span class="n">VARIABLE</span><span class="p">)</span>
        <span class="n">sym_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">getSymbolicVariable</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ast_vars</span><span class="p">]</span>
        <span class="n">final_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">avar</span><span class="p">,</span> <span class="n">svar</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ast_vars</span><span class="p">,</span> <span class="n">sym_vars</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">svar</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
                <span class="n">final_dict</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">svar</span><span class="o">.</span><span class="n">getId</span><span class="p">()]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">final_dict</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span> <span class="o">=</span> <span class="n">avar</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">final_dict</span></div>

<div class="viewcode-block" id="ProcessState.evaluate_expression_model"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.evaluate_expression_model">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_expression_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">Expression</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the given expression on the given model. The value returned is the</span>
<span class="sd">        integer value corresponding to the bitvector evaluation of the expression.</span>

<span class="sd">        :param exp: Symbolic Expression to evaluate</span>
<span class="sd">        :param model: Model generated by the solver</span>
<span class="sd">        :return: result of the evaluation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="s2">&quot;getAst&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">exp</span>

        <span class="nb">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_expression_variable_values_model</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="n">backup</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">backup</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">getConcreteVariableValue</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setConcreteVariableValue</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">final_value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tt_ctx</span><span class="o">.</span><span class="n">setConcreteVariableValue</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">backup</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">final_value</span></div>

    <span class="c1"># def enumerate_expression_value(self, exp: Union[AstNode, Expression], constraints: List[AstNode], values_blacklist: List[int], limit: int):</span>
    <span class="c1">#     # Written for when it will work</span>
    <span class="c1">#     solver = z3.SolverFor(&quot;QF_BV&quot;)</span>
    <span class="c1">#     ast = exp.getAst() if hasattr(exp, &quot;getAst&quot;) else exp</span>
    <span class="c1">#     z3ast = self.actx.tritonToZ3(ast)</span>
    <span class="c1">#</span>
    <span class="c1">#     solver.add([self.actx.tritonToZ3(x) for x in constraints])</span>
    <span class="c1">#     solver.add([z3ast != x for x in values_blacklist])</span>
    <span class="c1">#</span>
    <span class="c1">#     values = []  # retrieved values</span>
    <span class="c1">#</span>
    <span class="c1">#     while limit:</span>
    <span class="c1">#         res = solver.check()</span>
    <span class="c1">#         if res == z3.sat:</span>
    <span class="c1">#             model = solver.model()</span>
    <span class="c1">#             new_val = model.eval(z3ast)</span>
    <span class="c1">#             values.append(new_val)</span>
    <span class="c1">#             solver.add(z3ast != new_val)</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             return values</span>
    <span class="c1">#         limit -= 1</span>
    <span class="c1">#     return values</span>

<div class="viewcode-block" id="ProcessState.solve_enumerate_expression"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.solve_enumerate_expression">[docs]</a>    <span class="k">def</span> <span class="nf">solve_enumerate_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">AstNode</span><span class="p">,</span> <span class="n">Expression</span><span class="p">],</span> <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AstNode</span><span class="p">],</span> <span class="n">values_blacklist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Model</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="c1"># Written for when it will work</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">getAst</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="s2">&quot;getAst&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">exp</span>

        <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">land</span><span class="p">(</span><span class="n">constraints</span> <span class="o">+</span> <span class="p">[</span><span class="n">ast</span> <span class="o">!=</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values_blacklist</span><span class="p">])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">with_pp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">SolverStatus</span><span class="o">.</span><span class="n">SAT</span><span class="p">:</span>
                <span class="n">new_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression_model</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model</span><span class="p">,</span> <span class="n">new_val</span><span class="p">))</span>
                <span class="n">constraint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actx</span><span class="o">.</span><span class="n">land</span><span class="p">([</span><span class="n">constraint</span><span class="p">,</span> <span class="n">ast</span> <span class="o">!=</span> <span class="n">new_val</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="n">limit</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="ProcessState.from_loader"><a class="viewcode-back" href="../../api/process.html#tritondse.ProcessState.from_loader">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_loader</span><span class="p">(</span><span class="n">loader</span><span class="p">:</span> <span class="n">Loader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;ProcessState&#39;</span><span class="p">:</span>
        <span class="n">pstate</span> <span class="o">=</span> <span class="n">ProcessState</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">endianness</span><span class="p">)</span>

        <span class="c1"># Initialize the architecture of the processstate</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">initialize_context</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">architecture</span><span class="p">)</span>

        <span class="c1"># Set the program counter to points to entrypoint</span>
        <span class="n">pstate</span><span class="o">.</span><span class="n">cpu</span><span class="o">.</span><span class="n">program_counter</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">entry_point</span>

        <span class="c1"># Disable segmentation to map segments</span>
        <span class="k">with</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">without_segmentation</span><span class="p">():</span>
            <span class="c1"># Load memory areas in memory</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">seg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">memory_segments</span><span class="p">()):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">seg</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">seg</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A segment have to provide either a size or a content </span><span class="si">{</span><span class="n">seg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (skipped)&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">content</span> <span class="k">else</span> <span class="n">seg</span><span class="o">.</span><span class="n">size</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading 0x</span><span class="si">{</span><span class="n">seg</span><span class="o">.</span><span class="n">address</span><span class="si">:</span><span class="s2">#08x</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">seg</span><span class="o">.</span><span class="n">address</span><span class="o">+</span><span class="n">size</span><span class="si">:</span><span class="s2">#08x</span><span class="si">}</span><span class="s2"> size=</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">seg</span><span class="o">.</span><span class="n">perms</span><span class="p">,</span> <span class="n">seg</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">seg</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">seg</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="c1"># Apply dynamic relocations</span>
        <span class="n">cur_linkage_address</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">EXTERN_FUNC_BASE</span>

        <span class="c1"># Disable segmentation</span>
        <span class="k">with</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">without_segmentation</span><span class="p">():</span>
            <span class="c1"># Link imported functions in EXTERN_FUNC_BASE</span>
            <span class="k">for</span> <span class="n">fname</span><span class="p">,</span> <span class="n">rel_addr</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">imported_functions_relocations</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hooking </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">rel_addr</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># If we already linked this function (because another library uses it) we reuse the same</span>
                <span class="c1"># linkage address.</span>
                <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">pstate</span><span class="o">.</span><span class="n">dynamic_symbol_table</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">linkage_address</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">dynamic_symbol_table</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already added. </span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">rel_addr</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2"> linkage_addr=</span><span class="si">{</span><span class="n">linkage_address</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">rel_addr</span><span class="p">,</span> <span class="n">linkage_address</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Add symbol in dynamic_symbol_table</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">dynamic_symbol_table</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur_linkage_address</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

                    <span class="c1"># Apply relocation to our custom address in process memory</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">rel_addr</span><span class="p">,</span> <span class="n">cur_linkage_address</span><span class="p">)</span>
                    <span class="c1"># Increment linkage address number</span>
                    <span class="n">cur_linkage_address</span> <span class="o">+=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>

        <span class="c1"># Try initializing stack registers if a stack is present in maps</span>
        <span class="c1"># Map the stack</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">map_from_name</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">STACK_SEG</span><span class="p">)</span>
            <span class="n">alloc</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">base_pointer_register</span><span class="p">,</span> <span class="n">stack</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="n">stack</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="n">alloc</span><span class="p">)</span> <span class="c1"># Pointing right-out of the stack</span>
            <span class="n">pstate</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">stack_pointer_register</span><span class="p">,</span> <span class="n">stack</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="n">stack</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="n">alloc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;no stack segment has been created by the loader&quot;</span><span class="p">)</span>

        <span class="c1"># Search for a map to settle foreign symbols</span>
        <span class="n">segs</span> <span class="o">=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">find_map</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">EXTERN_SEG</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">segs</span><span class="p">:</span>
            <span class="n">symb_base</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>

            <span class="c1"># Link imported symbols</span>
            <span class="k">for</span> <span class="n">sname</span><span class="p">,</span> <span class="n">rel_addr</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">imported_variable_symbols_relocations</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hooking </span><span class="si">{</span><span class="n">sname</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">rel_addr</span><span class="si">:</span><span class="s2">#x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pstate</span><span class="o">.</span><span class="n">architecture</span> <span class="o">==</span> <span class="n">Architecture</span><span class="o">.</span><span class="n">X86_64</span><span class="p">:</span>  <span class="c1"># HACK: Keep rel_addr to directly write symbol on it</span>
                    <span class="c1"># Add symbol in dynamic_symbol_table</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">dynamic_symbol_table</span><span class="p">[</span><span class="n">sname</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rel_addr</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="c1">#pstate.memory.write_ptr(rel_addr, cur_linkage_address)  # Do not write anything as symbolic executor will do it</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Add symbol in dynamic_symbol_table</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">dynamic_symbol_table</span><span class="p">[</span><span class="n">sname</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">symb_base</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                    <span class="n">pstate</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">write_ptr</span><span class="p">(</span><span class="n">rel_addr</span><span class="p">,</span> <span class="n">symb_base</span><span class="p">)</span>

                <span class="n">symb_base</span> <span class="o">+=</span> <span class="n">pstate</span><span class="o">.</span><span class="n">ptr_size</span>

        <span class="k">for</span> <span class="n">reg_name</span> <span class="ow">in</span> <span class="n">pstate</span><span class="o">.</span><span class="n">cpu</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reg_name</span> <span class="ow">in</span> <span class="n">loader</span><span class="o">.</span><span class="n">cpustate</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">pstate</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">reg_name</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="n">cpustate</span><span class="p">[</span><span class="n">reg_name</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">loader</span><span class="o">.</span><span class="n">arch_mode</span><span class="p">:</span> <span class="c1"># If the processor&#39;s mode is provided</span>
            <span class="k">if</span> <span class="n">loader</span><span class="o">.</span><span class="n">arch_mode</span> <span class="o">==</span> <span class="n">ArchMode</span><span class="o">.</span><span class="n">THUMB</span><span class="p">:</span>
                <span class="n">pstate</span><span class="o">.</span><span class="n">set_thumb</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pstate</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Quarkslab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>